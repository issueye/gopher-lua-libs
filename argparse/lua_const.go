// argparse.lua for gopher-lua https://github.com/mpeterv/argparse
package argparse

const lua_argparse = "LS0gVGhlIE1JVCBMaWNlbnNlIChNSVQpCgotLSBDb3B5cmlnaHQgKGMpIDIwMTMgLSAyMDE4IFBldGVyIE1lbG5pY2hlbmtvCgotLSBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5IG9mCi0tIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlICJTb2Z0d2FyZSIpLCB0byBkZWFsIGluCi0tIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8KLS0gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YKLS0gdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLAotLSBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKCi0tIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbAotLSBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKLS0gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1IKLS0gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MKLS0gRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SCi0tIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUgotLSBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTgotLSBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoKbG9jYWwgZnVuY3Rpb24gZGVlcF91cGRhdGUodDEsIHQyKQogICAgZm9yIGssIHYgaW4gcGFpcnModDIpIGRvCiAgICAgICAgaWYgdHlwZSh2KSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgdiA9IGRlZXBfdXBkYXRlKHt9LCB2KQogICAgICAgIGVuZAoKICAgICAgICB0MVtrXSA9IHYKICAgIGVuZAoKICAgIHJldHVybiB0MQplbmQKCi0tIEEgcHJvcGVydHkgaXMgYSB0dXBsZSB7bmFtZSwgY2FsbGJhY2t9LgotLSBwcm9wZXJ0aWVzLmFyZ3MgaXMgbnVtYmVyIG9mIHByb3BlcnRpZXMgdGhhdCBjYW4gYmUgc2V0IGFzIGFyZ3VtZW50cwotLSB3aGVuIGNhbGxpbmcgYW4gb2JqZWN0Lgpsb2NhbCBmdW5jdGlvbiBjbGFzcyhwcm90b3R5cGUsIHByb3BlcnRpZXMsIHBhcmVudCkKICAgIC0tIENsYXNzIGlzIHRoZSBtZXRhdGFibGUgb2YgaXRzIGluc3RhbmNlcy4KICAgIGxvY2FsIGNsID0ge30KICAgIGNsLl9faW5kZXggPSBjbAoKICAgIGlmIHBhcmVudCB0aGVuCiAgICAgICAgY2wuX19wcm90b3R5cGUgPSBkZWVwX3VwZGF0ZShkZWVwX3VwZGF0ZSh7fSwgcGFyZW50Ll9fcHJvdG90eXBlKSwgcHJvdG90eXBlKQogICAgZWxzZQogICAgICAgIGNsLl9fcHJvdG90eXBlID0gcHJvdG90eXBlCiAgICBlbmQKCiAgICBpZiBwcm9wZXJ0aWVzIHRoZW4KICAgICAgICBsb2NhbCBuYW1lcyA9IHt9CgogICAgICAgIC0tIENyZWF0ZSBzZXR0ZXIgbWV0aG9kcyBhbmQgZmlsbCBzZXQgb2YgcHJvcGVydHkgbmFtZXMuCiAgICAgICAgZm9yIF8sIHByb3BlcnR5IGluIGlwYWlycyhwcm9wZXJ0aWVzKSBkbwogICAgICAgICAgICBsb2NhbCBuYW1lLCBjYWxsYmFjayA9IHByb3BlcnR5WzFdLCBwcm9wZXJ0eVsyXQoKICAgICAgICAgICAgY2xbbmFtZV0gPSBmdW5jdGlvbihzZWxmLCB2YWx1ZSkKICAgICAgICAgICAgICAgIGlmIG5vdCBjYWxsYmFjayhzZWxmLCB2YWx1ZSkgdGhlbgogICAgICAgICAgICAgICAgICAgIHNlbGZbIl8iIC4uIG5hbWVdID0gdmFsdWUKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgbmFtZXNbbmFtZV0gPSB0cnVlCiAgICAgICAgZW5kCgogICAgICAgIGZ1bmN0aW9uIGNsLl9fY2FsbChzZWxmLCAuLi4pCiAgICAgICAgICAgIC0tIFdoZW4gY2FsbGluZyBhbiBvYmplY3QsIGlmIHRoZSBmaXJzdCBhcmd1bWVudCBpcyBhIHRhYmxlLAogICAgICAgICAgICAtLSBpbnRlcnByZXQga2V5cyBhcyBwcm9wZXJ0eSBuYW1lcywgZWxzZSBkZWxlZ2F0ZSBhcmd1bWVudHMKICAgICAgICAgICAgLS0gdG8gY29ycmVzcG9uZGluZyBzZXR0ZXJzIGluIG9yZGVyLgogICAgICAgICAgICBsb2NhbCBmaXJzdCA9IC4uLgogICAgICAgICAgICBpZiB0eXBlKGZpcnN0KSA9PSAidGFibGUiIHRoZW4KICAgICAgICAgICAgICAgIGZvciBuYW1lLCB2YWx1ZSBpbiBwYWlycyhmaXJzdCkgZG8KICAgICAgICAgICAgICAgICAgICBpZiBuYW1lc1tuYW1lXSB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZbbmFtZV0oc2VsZiwgdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgbG9jYWwgbmFyZ3MgPSBzZWxlY3QoIiMiLCAuLi4pCgogICAgICAgICAgICAgICAgZm9yIGksIHByb3BlcnR5IGluIGlwYWlycyhwcm9wZXJ0aWVzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIGkgPiBuYXJncyBvciBpID4gcHJvcGVydGllcy5hcmdzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgYXJnID0gc2VsZWN0KGksIC4uLikKCiAgICAgICAgICAgICAgICAgICAgaWYgYXJnIH49IG5pbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZbcHJvcGVydHlbMV1dKHNlbGYsIGFyZykKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHJldHVybiBzZWxmCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBJZiBpbmRleGluZyBjbGFzcyBmYWlscywgZmFsbGJhY2sgdG8gaXRzIHBhcmVudC4KICAgIGxvY2FsIGNsYXNzX21ldGF0YWJsZSA9IHt9CiAgICBjbGFzc19tZXRhdGFibGUuX19pbmRleCA9IHBhcmVudAoKICAgIGZ1bmN0aW9uIGNsYXNzX21ldGF0YWJsZS5fX2NhbGwoc2VsZiwgLi4uKQogICAgICAgIC0tIENhbGxpbmcgYSBjbGFzcyByZXR1cm5zIGl0cyBpbnN0YW5jZS4KICAgICAgICAtLSBBcmd1bWVudHMgYXJlIGRlbGVnYXRlZCB0byB0aGUgaW5zdGFuY2UuCiAgICAgICAgbG9jYWwgb2JqZWN0ID0gZGVlcF91cGRhdGUoe30sIHNlbGYuX19wcm90b3R5cGUpCiAgICAgICAgc2V0bWV0YXRhYmxlKG9iamVjdCwgc2VsZikKICAgICAgICByZXR1cm4gb2JqZWN0KC4uLikKICAgIGVuZAoKICAgIHJldHVybiBzZXRtZXRhdGFibGUoY2wsIGNsYXNzX21ldGF0YWJsZSkKZW5kCgpsb2NhbCBmdW5jdGlvbiB0eXBlY2hlY2sobmFtZSwgdHlwZXMsIHZhbHVlKQogICAgZm9yIF8sIHR5cGVfIGluIGlwYWlycyh0eXBlcykgZG8KICAgICAgICBpZiB0eXBlKHZhbHVlKSA9PSB0eXBlXyB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBlcnJvcigoImJhZCBwcm9wZXJ0eSAnJXMnICglcyBleHBlY3RlZCwgZ290ICVzKSIpOmZvcm1hdChuYW1lLCB0YWJsZS5jb25jYXQodHlwZXMsICIgb3IgIiksIHR5cGUodmFsdWUpKSkKZW5kCgpsb2NhbCBmdW5jdGlvbiB0eXBlY2hlY2tlZChuYW1lLCAuLi4pCiAgICBsb2NhbCB0eXBlcyA9IHsuLi59CiAgICByZXR1cm4ge25hbWUsIGZ1bmN0aW9uKF8sIHZhbHVlKSB0eXBlY2hlY2sobmFtZSwgdHlwZXMsIHZhbHVlKSBlbmR9CmVuZAoKbG9jYWwgbXVsdGluYW1lID0geyJuYW1lIiwgZnVuY3Rpb24oc2VsZiwgdmFsdWUpCiAgICB0eXBlY2hlY2soIm5hbWUiLCB7InN0cmluZyJ9LCB2YWx1ZSkKCiAgICBmb3IgYWxpYXMgaW4gdmFsdWU6Z21hdGNoKCIlUysiKSBkbwogICAgICAgIHNlbGYuX25hbWUgPSBzZWxmLl9uYW1lIG9yIGFsaWFzCiAgICAgICAgdGFibGUuaW5zZXJ0KHNlbGYuX2FsaWFzZXMsIGFsaWFzKQogICAgZW5kCgogICAgLS0gRG8gbm90IHNldCBfbmFtZSBhcyB3aXRoIG90aGVyIHByb3BlcnRpZXMuCiAgICByZXR1cm4gdHJ1ZQplbmR9Cgpsb2NhbCBmdW5jdGlvbiBwYXJzZV9ib3VuZGFyaWVzKHN0cikKICAgIGlmIHRvbnVtYmVyKHN0cikgdGhlbgogICAgICAgIHJldHVybiB0b251bWJlcihzdHIpLCB0b251bWJlcihzdHIpCiAgICBlbmQKCiAgICBpZiBzdHIgPT0gIioiIHRoZW4KICAgICAgICByZXR1cm4gMCwgbWF0aC5odWdlCiAgICBlbmQKCiAgICBpZiBzdHIgPT0gIisiIHRoZW4KICAgICAgICByZXR1cm4gMSwgbWF0aC5odWdlCiAgICBlbmQKCiAgICBpZiBzdHIgPT0gIj8iIHRoZW4KICAgICAgICByZXR1cm4gMCwgMQogICAgZW5kCgogICAgaWYgc3RyOm1hdGNoICJeJWQrJS0lZCskIiB0aGVuCiAgICAgICAgbG9jYWwgbWluLCBtYXggPSBzdHI6bWF0Y2ggIl4oJWQrKSUtKCVkKykkIgogICAgICAgIHJldHVybiB0b251bWJlcihtaW4pLCB0b251bWJlcihtYXgpCiAgICBlbmQKCiAgICBpZiBzdHI6bWF0Y2ggIl4lZCslKyQiIHRoZW4KICAgICAgICBsb2NhbCBtaW4gPSBzdHI6bWF0Y2ggIl4oJWQrKSUrJCIKICAgICAgICByZXR1cm4gdG9udW1iZXIobWluKSwgbWF0aC5odWdlCiAgICBlbmQKZW5kCgpsb2NhbCBmdW5jdGlvbiBib3VuZGFyaWVzKG5hbWUpCiAgICByZXR1cm4ge25hbWUsIGZ1bmN0aW9uKHNlbGYsIHZhbHVlKQogICAgICAgIHR5cGVjaGVjayhuYW1lLCB7Im51bWJlciIsICJzdHJpbmcifSwgdmFsdWUpCgogICAgICAgIGxvY2FsIG1pbiwgbWF4ID0gcGFyc2VfYm91bmRhcmllcyh2YWx1ZSkKCiAgICAgICAgaWYgbm90IG1pbiB0aGVuCiAgICAgICAgICAgIGVycm9yKCgiYmFkIHByb3BlcnR5ICclcyciKTpmb3JtYXQobmFtZSkpCiAgICAgICAgZW5kCgogICAgICAgIHNlbGZbIl9taW4iIC4uIG5hbWVdLCBzZWxmWyJfbWF4IiAuLiBuYW1lXSA9IG1pbiwgbWF4CiAgICBlbmR9CmVuZAoKbG9jYWwgYWN0aW9ucyA9IHt9Cgpsb2NhbCBvcHRpb25fYWN0aW9uID0geyJhY3Rpb24iLCBmdW5jdGlvbihfLCB2YWx1ZSkKICAgIHR5cGVjaGVjaygiYWN0aW9uIiwgeyJmdW5jdGlvbiIsICJzdHJpbmcifSwgdmFsdWUpCgogICAgaWYgdHlwZSh2YWx1ZSkgPT0gInN0cmluZyIgYW5kIG5vdCBhY3Rpb25zW3ZhbHVlXSB0aGVuCiAgICAgICAgZXJyb3IoKCJ1bmtub3duIGFjdGlvbiAnJXMnIik6Zm9ybWF0KHZhbHVlKSkKICAgIGVuZAplbmR9Cgpsb2NhbCBvcHRpb25faW5pdCA9IHsiaW5pdCIsIGZ1bmN0aW9uKHNlbGYpCiAgICBzZWxmLl9oYXNfaW5pdCA9IHRydWUKZW5kfQoKbG9jYWwgb3B0aW9uX2RlZmF1bHQgPSB7ImRlZmF1bHQiLCBmdW5jdGlvbihzZWxmLCB2YWx1ZSkKICAgIGlmIHR5cGUodmFsdWUpIH49ICJzdHJpbmciIHRoZW4KICAgICAgICBzZWxmLl9pbml0ID0gdmFsdWUKICAgICAgICBzZWxmLl9oYXNfaW5pdCA9IHRydWUKICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCmVuZH0KCmxvY2FsIGFkZF9oZWxwID0geyJhZGRfaGVscCIsIGZ1bmN0aW9uKHNlbGYsIHZhbHVlKQogICAgdHlwZWNoZWNrKCJhZGRfaGVscCIsIHsiYm9vbGVhbiIsICJzdHJpbmciLCAidGFibGUifSwgdmFsdWUpCgogICAgaWYgc2VsZi5faGFzX2hlbHAgdGhlbgogICAgICAgIHRhYmxlLnJlbW92ZShzZWxmLl9vcHRpb25zKQogICAgICAgIHNlbGYuX2hhc19oZWxwID0gZmFsc2UKICAgIGVuZAoKICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICBsb2NhbCBoZWxwID0gc2VsZjpmbGFnKCkKICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXNjcmlwdGlvbiAiU2hvdyB0aGlzIGhlbHAgbWVzc2FnZSBhbmQgZXhpdC4iCiAgICAgICAgICAgICAgICAgICAgICAgICA6YWN0aW9uKGZ1bmN0aW9uKCkKICAgICAgICAgICAgcHJpbnQoc2VsZjpnZXRfaGVscCgpKQogICAgICAgICAgICBvcy5leGl0KDApCiAgICAgICAgZW5kKQoKICAgICAgICBpZiB2YWx1ZSB+PSB0cnVlIHRoZW4KICAgICAgICAgICAgaGVscCA9IGhlbHAodmFsdWUpCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBoZWxwLl9uYW1lIHRoZW4KICAgICAgICAgICAgaGVscCAiLWgiICItLWhlbHAiCiAgICAgICAgZW5kCgogICAgICAgIHNlbGYuX2hhc19oZWxwID0gdHJ1ZQogICAgZW5kCmVuZH0KCmxvY2FsIFBhcnNlciA9IGNsYXNzKHsKICAgIF9hcmd1bWVudHMgPSB7fSwKICAgIF9vcHRpb25zID0ge30sCiAgICBfY29tbWFuZHMgPSB7fSwKICAgIF9tdXRleGVzID0ge30sCiAgICBfZ3JvdXBzID0ge30sCiAgICBfcmVxdWlyZV9jb21tYW5kID0gdHJ1ZSwKICAgIF9oYW5kbGVfb3B0aW9ucyA9IHRydWUKfSwgewogICAgYXJncyA9IDMsCiAgICB0eXBlY2hlY2tlZCgibmFtZSIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJkZXNjcmlwdGlvbiIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJlcGlsb2ciLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgidXNhZ2UiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscCIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJyZXF1aXJlX2NvbW1hbmQiLCAiYm9vbGVhbiIpLAogICAgdHlwZWNoZWNrZWQoImhhbmRsZV9vcHRpb25zIiwgImJvb2xlYW4iKSwKICAgIHR5cGVjaGVja2VkKCJhY3Rpb24iLCAiZnVuY3Rpb24iKSwKICAgIHR5cGVjaGVja2VkKCJjb21tYW5kX3RhcmdldCIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJoZWxwX3ZlcnRpY2FsX3NwYWNlIiwgIm51bWJlciIpLAogICAgdHlwZWNoZWNrZWQoInVzYWdlX21hcmdpbiIsICJudW1iZXIiKSwKICAgIHR5cGVjaGVja2VkKCJ1c2FnZV9tYXhfd2lkdGgiLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscF91c2FnZV9tYXJnaW4iLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscF9kZXNjcmlwdGlvbl9tYXJnaW4iLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscF9tYXhfd2lkdGgiLCAibnVtYmVyIiksCiAgICBhZGRfaGVscAp9KQoKbG9jYWwgQ29tbWFuZCA9IGNsYXNzKHsKICAgIF9hbGlhc2VzID0ge30KfSwgewogICAgYXJncyA9IDMsCiAgICBtdWx0aW5hbWUsCiAgICB0eXBlY2hlY2tlZCgiZGVzY3JpcHRpb24iLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgiZXBpbG9nIiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoInRhcmdldCIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJ1c2FnZSIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJoZWxwIiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoInJlcXVpcmVfY29tbWFuZCIsICJib29sZWFuIiksCiAgICB0eXBlY2hlY2tlZCgiaGFuZGxlX29wdGlvbnMiLCAiYm9vbGVhbiIpLAogICAgdHlwZWNoZWNrZWQoImFjdGlvbiIsICJmdW5jdGlvbiIpLAogICAgdHlwZWNoZWNrZWQoImNvbW1hbmRfdGFyZ2V0IiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoImhlbHBfdmVydGljYWxfc3BhY2UiLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgidXNhZ2VfbWFyZ2luIiwgIm51bWJlciIpLAogICAgdHlwZWNoZWNrZWQoInVzYWdlX21heF93aWR0aCIsICJudW1iZXIiKSwKICAgIHR5cGVjaGVja2VkKCJoZWxwX3VzYWdlX21hcmdpbiIsICJudW1iZXIiKSwKICAgIHR5cGVjaGVja2VkKCJoZWxwX2Rlc2NyaXB0aW9uX21hcmdpbiIsICJudW1iZXIiKSwKICAgIHR5cGVjaGVja2VkKCJoZWxwX21heF93aWR0aCIsICJudW1iZXIiKSwKICAgIHR5cGVjaGVja2VkKCJoaWRkZW4iLCAiYm9vbGVhbiIpLAogICAgYWRkX2hlbHAKfSwgUGFyc2VyKQoKbG9jYWwgQXJndW1lbnQgPSBjbGFzcyh7CiAgICBfbWluYXJncyA9IDEsCiAgICBfbWF4YXJncyA9IDEsCiAgICBfbWluY291bnQgPSAxLAogICAgX21heGNvdW50ID0gMSwKICAgIF9kZWZtb2RlID0gInVudXNlZCIsCiAgICBfc2hvd19kZWZhdWx0ID0gdHJ1ZQp9LCB7CiAgICBhcmdzID0gNSwKICAgIHR5cGVjaGVja2VkKCJuYW1lIiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoImRlc2NyaXB0aW9uIiwgInN0cmluZyIpLAogICAgb3B0aW9uX2RlZmF1bHQsCiAgICB0eXBlY2hlY2tlZCgiY29udmVydCIsICJmdW5jdGlvbiIsICJ0YWJsZSIpLAogICAgYm91bmRhcmllcygiYXJncyIpLAogICAgdHlwZWNoZWNrZWQoInRhcmdldCIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJkZWZtb2RlIiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoInNob3dfZGVmYXVsdCIsICJib29sZWFuIiksCiAgICB0eXBlY2hlY2tlZCgiYXJnbmFtZSIsICJzdHJpbmciLCAidGFibGUiKSwKICAgIHR5cGVjaGVja2VkKCJoaWRkZW4iLCAiYm9vbGVhbiIpLAogICAgb3B0aW9uX2FjdGlvbiwKICAgIG9wdGlvbl9pbml0Cn0pCgpsb2NhbCBPcHRpb24gPSBjbGFzcyh7CiAgICBfYWxpYXNlcyA9IHt9LAogICAgX21pbmNvdW50ID0gMCwKICAgIF9vdmVyd3JpdGUgPSB0cnVlCn0sIHsKICAgIGFyZ3MgPSA2LAogICAgbXVsdGluYW1lLAogICAgdHlwZWNoZWNrZWQoImRlc2NyaXB0aW9uIiwgInN0cmluZyIpLAogICAgb3B0aW9uX2RlZmF1bHQsCiAgICB0eXBlY2hlY2tlZCgiY29udmVydCIsICJmdW5jdGlvbiIsICJ0YWJsZSIpLAogICAgYm91bmRhcmllcygiYXJncyIpLAogICAgYm91bmRhcmllcygiY291bnQiKSwKICAgIHR5cGVjaGVja2VkKCJ0YXJnZXQiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgiZGVmbW9kZSIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJzaG93X2RlZmF1bHQiLCAiYm9vbGVhbiIpLAogICAgdHlwZWNoZWNrZWQoIm92ZXJ3cml0ZSIsICJib29sZWFuIiksCiAgICB0eXBlY2hlY2tlZCgiYXJnbmFtZSIsICJzdHJpbmciLCAidGFibGUiKSwKICAgIHR5cGVjaGVja2VkKCJoaWRkZW4iLCAiYm9vbGVhbiIpLAogICAgb3B0aW9uX2FjdGlvbiwKICAgIG9wdGlvbl9pbml0Cn0sIEFyZ3VtZW50KQoKZnVuY3Rpb24gUGFyc2VyOl9pbmhlcml0X3Byb3BlcnR5KG5hbWUsIGRlZmF1bHQpCiAgICBsb2NhbCBlbGVtZW50ID0gc2VsZgoKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBsb2NhbCB2YWx1ZSA9IGVsZW1lbnRbIl8iIC4uIG5hbWVdCgogICAgICAgIGlmIHZhbHVlIH49IG5pbCB0aGVuCiAgICAgICAgICAgIHJldHVybiB2YWx1ZQogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgZWxlbWVudC5fcGFyZW50IHRoZW4KICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHQKICAgICAgICBlbmQKCiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQuX3BhcmVudAogICAgZW5kCmVuZAoKZnVuY3Rpb24gQXJndW1lbnQ6X2dldF9hcmd1bWVudF9saXN0KCkKICAgIGxvY2FsIGJ1ZiA9IHt9CiAgICBsb2NhbCBpID0gMQoKICAgIHdoaWxlIGkgPD0gbWF0aC5taW4oc2VsZi5fbWluYXJncywgMykgZG8KICAgICAgICBsb2NhbCBhcmduYW1lID0gc2VsZjpfZ2V0X2FyZ25hbWUoaSkKCiAgICAgICAgaWYgc2VsZi5fZGVmYXVsdCBhbmQgc2VsZi5fZGVmbW9kZTpmaW5kICJhIiB0aGVuCiAgICAgICAgICAgIGFyZ25hbWUgPSAiWyIgLi4gYXJnbmFtZSAuLiAiXSIKICAgICAgICBlbmQKCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgYXJnbmFtZSkKICAgICAgICBpID0gaSsxCiAgICBlbmQKCiAgICB3aGlsZSBpIDw9IG1hdGgubWluKHNlbGYuX21heGFyZ3MsIDMpIGRvCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgIlsiIC4uIHNlbGY6X2dldF9hcmduYW1lKGkpIC4uICJdIikKICAgICAgICBpID0gaSsxCgogICAgICAgIGlmIHNlbGYuX21heGFyZ3MgPT0gbWF0aC5odWdlIHRoZW4KICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmIGkgPCBzZWxmLl9tYXhhcmdzIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAiLi4uIikKICAgIGVuZAoKICAgIHJldHVybiBidWYKZW5kCgpmdW5jdGlvbiBBcmd1bWVudDpfZ2V0X3VzYWdlKCkKICAgIGxvY2FsIHVzYWdlID0gdGFibGUuY29uY2F0KHNlbGY6X2dldF9hcmd1bWVudF9saXN0KCksICIgIikKCiAgICBpZiBzZWxmLl9kZWZhdWx0IGFuZCBzZWxmLl9kZWZtb2RlOmZpbmQgInUiIHRoZW4KICAgICAgICBpZiBzZWxmLl9tYXhhcmdzID4gMSBvciAoc2VsZi5fbWluYXJncyA9PSAxIGFuZCBub3Qgc2VsZi5fZGVmbW9kZTpmaW5kICJhIikgdGhlbgogICAgICAgICAgICB1c2FnZSA9ICJbIiAuLiB1c2FnZSAuLiAiXSIKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiB1c2FnZQplbmQKCmZ1bmN0aW9uIGFjdGlvbnMuc3RvcmVfdHJ1ZShyZXN1bHQsIHRhcmdldCkKICAgIHJlc3VsdFt0YXJnZXRdID0gdHJ1ZQplbmQKCmZ1bmN0aW9uIGFjdGlvbnMuc3RvcmVfZmFsc2UocmVzdWx0LCB0YXJnZXQpCiAgICByZXN1bHRbdGFyZ2V0XSA9IGZhbHNlCmVuZAoKZnVuY3Rpb24gYWN0aW9ucy5zdG9yZShyZXN1bHQsIHRhcmdldCwgYXJndW1lbnQpCiAgICByZXN1bHRbdGFyZ2V0XSA9IGFyZ3VtZW50CmVuZAoKZnVuY3Rpb24gYWN0aW9ucy5jb3VudChyZXN1bHQsIHRhcmdldCwgXywgb3ZlcndyaXRlKQogICAgaWYgbm90IG92ZXJ3cml0ZSB0aGVuCiAgICAgICAgcmVzdWx0W3RhcmdldF0gPSByZXN1bHRbdGFyZ2V0XSArIDEKICAgIGVuZAplbmQKCmZ1bmN0aW9uIGFjdGlvbnMuYXBwZW5kKHJlc3VsdCwgdGFyZ2V0LCBhcmd1bWVudCwgb3ZlcndyaXRlKQogICAgcmVzdWx0W3RhcmdldF0gPSByZXN1bHRbdGFyZ2V0XSBvciB7fQogICAgdGFibGUuaW5zZXJ0KHJlc3VsdFt0YXJnZXRdLCBhcmd1bWVudCkKCiAgICBpZiBvdmVyd3JpdGUgdGhlbgogICAgICAgIHRhYmxlLnJlbW92ZShyZXN1bHRbdGFyZ2V0XSwgMSkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIGFjdGlvbnMuY29uY2F0KHJlc3VsdCwgdGFyZ2V0LCBhcmd1bWVudHMsIG92ZXJ3cml0ZSkKICAgIGlmIG92ZXJ3cml0ZSB0aGVuCiAgICAgICAgZXJyb3IoIidjb25jYXQnIGFjdGlvbiBjYW4ndCBoYW5kbGUgdG9vIG1hbnkgaW52b2NhdGlvbnMiKQogICAgZW5kCgogICAgcmVzdWx0W3RhcmdldF0gPSByZXN1bHRbdGFyZ2V0XSBvciB7fQoKICAgIGZvciBfLCBhcmd1bWVudCBpbiBpcGFpcnMoYXJndW1lbnRzKSBkbwogICAgICAgIHRhYmxlLmluc2VydChyZXN1bHRbdGFyZ2V0XSwgYXJndW1lbnQpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBBcmd1bWVudDpfZ2V0X2FjdGlvbigpCiAgICBsb2NhbCBhY3Rpb24sIGluaXQKCiAgICBpZiBzZWxmLl9tYXhjb3VudCA9PSAxIHRoZW4KICAgICAgICBpZiBzZWxmLl9tYXhhcmdzID09IDAgdGhlbgogICAgICAgICAgICBhY3Rpb24sIGluaXQgPSAic3RvcmVfdHJ1ZSIsIG5pbAogICAgICAgIGVsc2UKICAgICAgICAgICAgYWN0aW9uLCBpbml0ID0gInN0b3JlIiwgbmlsCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgaWYgc2VsZi5fbWF4YXJncyA9PSAwIHRoZW4KICAgICAgICAgICAgYWN0aW9uLCBpbml0ID0gImNvdW50IiwgMAogICAgICAgIGVsc2UKICAgICAgICAgICAgYWN0aW9uLCBpbml0ID0gImFwcGVuZCIsIHt9CiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiBzZWxmLl9hY3Rpb24gdGhlbgogICAgICAgIGFjdGlvbiA9IHNlbGYuX2FjdGlvbgogICAgZW5kCgogICAgaWYgc2VsZi5faGFzX2luaXQgdGhlbgogICAgICAgIGluaXQgPSBzZWxmLl9pbml0CiAgICBlbmQKCiAgICBpZiB0eXBlKGFjdGlvbikgPT0gInN0cmluZyIgdGhlbgogICAgICAgIGFjdGlvbiA9IGFjdGlvbnNbYWN0aW9uXQogICAgZW5kCgogICAgcmV0dXJuIGFjdGlvbiwgaW5pdAplbmQKCi0tIFJldHVybnMgcGxhY2Vob2xkZXIgZm9yIGBuYXJnYC10aCBhcmd1bWVudC4KZnVuY3Rpb24gQXJndW1lbnQ6X2dldF9hcmduYW1lKG5hcmcpCiAgICBsb2NhbCBhcmduYW1lID0gc2VsZi5fYXJnbmFtZSBvciBzZWxmOl9nZXRfZGVmYXVsdF9hcmduYW1lKCkKCiAgICBpZiB0eXBlKGFyZ25hbWUpID09ICJ0YWJsZSIgdGhlbgogICAgICAgIHJldHVybiBhcmduYW1lW25hcmddCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIGFyZ25hbWUKICAgIGVuZAplbmQKCmZ1bmN0aW9uIEFyZ3VtZW50Ol9nZXRfZGVmYXVsdF9hcmduYW1lKCkKICAgIHJldHVybiAiPCIgLi4gc2VsZi5fbmFtZSAuLiAiPiIKZW5kCgpmdW5jdGlvbiBPcHRpb246X2dldF9kZWZhdWx0X2FyZ25hbWUoKQogICAgcmV0dXJuICI8IiAuLiBzZWxmOl9nZXRfZGVmYXVsdF90YXJnZXQoKSAuLiAiPiIKZW5kCgotLSBSZXR1cm5zIGxhYmVscyB0byBiZSBzaG93biBpbiB0aGUgaGVscCBtZXNzYWdlLgpmdW5jdGlvbiBBcmd1bWVudDpfZ2V0X2xhYmVsX2xpbmVzKCkKICAgIHJldHVybiB7c2VsZi5fbmFtZX0KZW5kCgpmdW5jdGlvbiBPcHRpb246X2dldF9sYWJlbF9saW5lcygpCiAgICBsb2NhbCBhcmd1bWVudF9saXN0ID0gc2VsZjpfZ2V0X2FyZ3VtZW50X2xpc3QoKQoKICAgIGlmICNhcmd1bWVudF9saXN0ID09IDAgdGhlbgogICAgICAgIC0tIERvbid0IHB1dCBhbGlhc2VzIGZvciBzaW1wbGUgZmxhZ3MgbGlrZSBgLWhgIG9uIGRpZmZlcmVudCBsaW5lcy4KICAgICAgICByZXR1cm4ge3RhYmxlLmNvbmNhdChzZWxmLl9hbGlhc2VzLCAiLCAiKX0KICAgIGVuZAoKICAgIGxvY2FsIGxvbmdlc3RfYWxpYXNfbGVuZ3RoID0gLTEKCiAgICBmb3IgXywgYWxpYXMgaW4gaXBhaXJzKHNlbGYuX2FsaWFzZXMpIGRvCiAgICAgICAgbG9uZ2VzdF9hbGlhc19sZW5ndGggPSBtYXRoLm1heChsb25nZXN0X2FsaWFzX2xlbmd0aCwgI2FsaWFzKQogICAgZW5kCgogICAgbG9jYWwgYXJndW1lbnRfbGlzdF9yZXByID0gdGFibGUuY29uY2F0KGFyZ3VtZW50X2xpc3QsICIgIikKICAgIGxvY2FsIGxpbmVzID0ge30KCiAgICBmb3IgaSwgYWxpYXMgaW4gaXBhaXJzKHNlbGYuX2FsaWFzZXMpIGRvCiAgICAgICAgbG9jYWwgbGluZSA9ICgiICIpOnJlcChsb25nZXN0X2FsaWFzX2xlbmd0aCAtICNhbGlhcykgLi4gYWxpYXMgLi4gIiAiIC4uIGFyZ3VtZW50X2xpc3RfcmVwcgoKICAgICAgICBpZiBpIH49ICNzZWxmLl9hbGlhc2VzIHRoZW4KICAgICAgICAgICAgbGluZSA9IGxpbmUgLi4gIiwiCiAgICAgICAgZW5kCgogICAgICAgIHRhYmxlLmluc2VydChsaW5lcywgbGluZSkKICAgIGVuZAoKICAgIHJldHVybiBsaW5lcwplbmQKCmZ1bmN0aW9uIENvbW1hbmQ6X2dldF9sYWJlbF9saW5lcygpCiAgICByZXR1cm4ge3RhYmxlLmNvbmNhdChzZWxmLl9hbGlhc2VzLCAiLCAiKX0KZW5kCgpmdW5jdGlvbiBBcmd1bWVudDpfZ2V0X2Rlc2NyaXB0aW9uKCkKICAgIGlmIHNlbGYuX2RlZmF1bHQgYW5kIHNlbGYuX3Nob3dfZGVmYXVsdCB0aGVuCiAgICAgICAgaWYgc2VsZi5fZGVzY3JpcHRpb24gdGhlbgogICAgICAgICAgICByZXR1cm4gKCIlcyAoZGVmYXVsdDogJXMpIik6Zm9ybWF0KHNlbGYuX2Rlc2NyaXB0aW9uLCBzZWxmLl9kZWZhdWx0KQogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuICgiZGVmYXVsdDogJXMiKTpmb3JtYXQoc2VsZi5fZGVmYXVsdCkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICByZXR1cm4gc2VsZi5fZGVzY3JpcHRpb24gb3IgIiIKICAgIGVuZAplbmQKCmZ1bmN0aW9uIENvbW1hbmQ6X2dldF9kZXNjcmlwdGlvbigpCiAgICByZXR1cm4gc2VsZi5fZGVzY3JpcHRpb24gb3IgIiIKZW5kCgpmdW5jdGlvbiBPcHRpb246X2dldF91c2FnZSgpCiAgICBsb2NhbCB1c2FnZSA9IHNlbGY6X2dldF9hcmd1bWVudF9saXN0KCkKICAgIHRhYmxlLmluc2VydCh1c2FnZSwgMSwgc2VsZi5fbmFtZSkKICAgIHVzYWdlID0gdGFibGUuY29uY2F0KHVzYWdlLCAiICIpCgogICAgaWYgc2VsZi5fbWluY291bnQgPT0gMCBvciBzZWxmLl9kZWZhdWx0IHRoZW4KICAgICAgICB1c2FnZSA9ICJbIiAuLiB1c2FnZSAuLiAiXSIKICAgIGVuZAoKICAgIHJldHVybiB1c2FnZQplbmQKCmZ1bmN0aW9uIEFyZ3VtZW50Ol9nZXRfZGVmYXVsdF90YXJnZXQoKQogICAgcmV0dXJuIHNlbGYuX25hbWUKZW5kCgpmdW5jdGlvbiBPcHRpb246X2dldF9kZWZhdWx0X3RhcmdldCgpCiAgICBsb2NhbCByZXMKCiAgICBmb3IgXywgYWxpYXMgaW4gaXBhaXJzKHNlbGYuX2FsaWFzZXMpIGRvCiAgICAgICAgaWYgYWxpYXM6c3ViKDEsIDEpID09IGFsaWFzOnN1YigyLCAyKSB0aGVuCiAgICAgICAgICAgIHJlcyA9IGFsaWFzOnN1YigzKQogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgZW5kCgogICAgcmVzID0gcmVzIG9yIHNlbGYuX25hbWU6c3ViKDIpCiAgICByZXR1cm4gKHJlczpnc3ViKCItIiwgIl8iKSkKZW5kCgpmdW5jdGlvbiBPcHRpb246X2lzX3ZhcmFyZygpCiAgICByZXR1cm4gc2VsZi5fbWF4YXJncyB+PSBzZWxmLl9taW5hcmdzCmVuZAoKZnVuY3Rpb24gUGFyc2VyOl9nZXRfZnVsbG5hbWUoKQogICAgbG9jYWwgcGFyZW50ID0gc2VsZi5fcGFyZW50CiAgICBsb2NhbCBidWYgPSB7c2VsZi5fbmFtZX0KCiAgICB3aGlsZSBwYXJlbnQgZG8KICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAxLCBwYXJlbnQuX25hbWUpCiAgICAgICAgcGFyZW50ID0gcGFyZW50Ll9wYXJlbnQKICAgIGVuZAoKICAgIHJldHVybiB0YWJsZS5jb25jYXQoYnVmLCAiICIpCmVuZAoKZnVuY3Rpb24gUGFyc2VyOl91cGRhdGVfY2hhcnNldChjaGFyc2V0KQogICAgY2hhcnNldCA9IGNoYXJzZXQgb3Ige30KCiAgICBmb3IgXywgY29tbWFuZCBpbiBpcGFpcnMoc2VsZi5fY29tbWFuZHMpIGRvCiAgICAgICAgY29tbWFuZDpfdXBkYXRlX2NoYXJzZXQoY2hhcnNldCkKICAgIGVuZAoKICAgIGZvciBfLCBvcHRpb24gaW4gaXBhaXJzKHNlbGYuX29wdGlvbnMpIGRvCiAgICAgICAgZm9yIF8sIGFsaWFzIGluIGlwYWlycyhvcHRpb24uX2FsaWFzZXMpIGRvCiAgICAgICAgICAgIGNoYXJzZXRbYWxpYXM6c3ViKDEsIDEpXSA9IHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiBjaGFyc2V0CmVuZAoKZnVuY3Rpb24gUGFyc2VyOmFyZ3VtZW50KC4uLikKICAgIGxvY2FsIGFyZ3VtZW50ID0gQXJndW1lbnQoLi4uKQogICAgdGFibGUuaW5zZXJ0KHNlbGYuX2FyZ3VtZW50cywgYXJndW1lbnQpCiAgICByZXR1cm4gYXJndW1lbnQKZW5kCgpmdW5jdGlvbiBQYXJzZXI6b3B0aW9uKC4uLikKICAgIGxvY2FsIG9wdGlvbiA9IE9wdGlvbiguLi4pCgogICAgaWYgc2VsZi5faGFzX2hlbHAgdGhlbgogICAgICAgIHRhYmxlLmluc2VydChzZWxmLl9vcHRpb25zLCAjc2VsZi5fb3B0aW9ucywgb3B0aW9uKQogICAgZWxzZQogICAgICAgIHRhYmxlLmluc2VydChzZWxmLl9vcHRpb25zLCBvcHRpb24pCiAgICBlbmQKCiAgICByZXR1cm4gb3B0aW9uCmVuZAoKZnVuY3Rpb24gUGFyc2VyOmZsYWcoLi4uKQogICAgcmV0dXJuIHNlbGY6b3B0aW9uKCk6YXJncygwKSguLi4pCmVuZAoKZnVuY3Rpb24gUGFyc2VyOmNvbW1hbmQoLi4uKQogICAgbG9jYWwgY29tbWFuZCA9IENvbW1hbmQoKTphZGRfaGVscCh0cnVlKSguLi4pCiAgICBjb21tYW5kLl9wYXJlbnQgPSBzZWxmCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5fY29tbWFuZHMsIGNvbW1hbmQpCiAgICByZXR1cm4gY29tbWFuZAplbmQKCmZ1bmN0aW9uIFBhcnNlcjptdXRleCguLi4pCiAgICBsb2NhbCBlbGVtZW50cyA9IHsuLi59CgogICAgZm9yIGksIGVsZW1lbnQgaW4gaXBhaXJzKGVsZW1lbnRzKSBkbwogICAgICAgIGxvY2FsIG10ID0gZ2V0bWV0YXRhYmxlKGVsZW1lbnQpCiAgICAgICAgYXNzZXJ0KG10ID09IE9wdGlvbiBvciBtdCA9PSBBcmd1bWVudCwgKCJiYWQgYXJndW1lbnQgIyVkIHRvICdtdXRleCcgKE9wdGlvbiBvciBBcmd1bWVudCBleHBlY3RlZCkiKTpmb3JtYXQoaSkpCiAgICBlbmQKCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5fbXV0ZXhlcywgZWxlbWVudHMpCiAgICByZXR1cm4gc2VsZgplbmQKCmZ1bmN0aW9uIFBhcnNlcjpncm91cChuYW1lLCAuLi4pCiAgICBhc3NlcnQodHlwZShuYW1lKSA9PSAic3RyaW5nIiwgKCJiYWQgYXJndW1lbnQgIzEgdG8gJ2dyb3VwJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgJXMpIik6Zm9ybWF0KHR5cGUobmFtZSkpKQoKICAgIGxvY2FsIGdyb3VwID0ge25hbWUgPSBuYW1lLCAuLi59CgogICAgZm9yIGksIGVsZW1lbnQgaW4gaXBhaXJzKGdyb3VwKSBkbwogICAgICAgIGxvY2FsIG10ID0gZ2V0bWV0YXRhYmxlKGVsZW1lbnQpCiAgICAgICAgYXNzZXJ0KG10ID09IE9wdGlvbiBvciBtdCA9PSBBcmd1bWVudCBvciBtdCA9PSBDb21tYW5kLAogICAgICAgICAgICAgICAgKCJiYWQgYXJndW1lbnQgIyVkIHRvICdncm91cCcgKE9wdGlvbiBvciBBcmd1bWVudCBvciBDb21tYW5kIGV4cGVjdGVkKSIpOmZvcm1hdChpICsgMSkpCiAgICBlbmQKCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5fZ3JvdXBzLCBncm91cCkKICAgIHJldHVybiBzZWxmCmVuZAoKbG9jYWwgdXNhZ2Vfd2VsY29tZSA9ICJVc2FnZTogIgoKZnVuY3Rpb24gUGFyc2VyOmdldF91c2FnZSgpCiAgICBpZiBzZWxmLl91c2FnZSB0aGVuCiAgICAgICAgcmV0dXJuIHNlbGYuX3VzYWdlCiAgICBlbmQKCiAgICBsb2NhbCB1c2FnZV9tYXJnaW4gPSBzZWxmOl9pbmhlcml0X3Byb3BlcnR5KCJ1c2FnZV9tYXJnaW4iLCAjdXNhZ2Vfd2VsY29tZSkKICAgIGxvY2FsIG1heF91c2FnZV93aWR0aCA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoInVzYWdlX21heF93aWR0aCIsIDcwKQogICAgbG9jYWwgbGluZXMgPSB7dXNhZ2Vfd2VsY29tZSAuLiBzZWxmOl9nZXRfZnVsbG5hbWUoKX0KCiAgICBsb2NhbCBmdW5jdGlvbiBhZGQocykKICAgICAgICBpZiAjbGluZXNbI2xpbmVzXSsxKyNzIDw9IG1heF91c2FnZV93aWR0aCB0aGVuCiAgICAgICAgICAgIGxpbmVzWyNsaW5lc10gPSBsaW5lc1sjbGluZXNdIC4uICIgIiAuLiBzCiAgICAgICAgZWxzZQogICAgICAgICAgICBsaW5lc1sjbGluZXMrMV0gPSAoIiAiKTpyZXAodXNhZ2VfbWFyZ2luKSAuLiBzCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBOb3JtYWxseSBvcHRpb25zIGFyZSBiZWZvcmUgcG9zaXRpb25hbCBhcmd1bWVudHMgaW4gdXNhZ2UgbWVzc2FnZXMuCiAgICAtLSBIb3dldmVyLCB2YXJhcmcgb3B0aW9ucyBzaG91bGQgYmUgYWZ0ZXIsIGJlY2F1c2UgdGhleSBjYW4ndCBiZSByZWxpYWJsZSB1c2VkCiAgICAtLSBiZWZvcmUgYSBwb3NpdGlvbmFsIGFyZ3VtZW50LgogICAgLS0gTXV0ZXhlcyBjb21lIGludG8gcGxheSwgdG9vLCBhbmQgYXJlIHNob3duIGFzIHNvb24gYXMgcG9zc2libGUuCiAgICAtLSBPdmVyYWxsLCBvdXRwdXQgdXNhZ2VzIGluIHRoZSBmb2xsb3dpbmcgb3JkZXI6CiAgICAtLSAxLiBNdXRleGVzIHRoYXQgZG9uJ3QgaGF2ZSBwb3NpdGlvbmFsIGFyZ3VtZW50cyBvciB2YXJhcmcgb3B0aW9ucy4KICAgIC0tIDIuIE9wdGlvbnMgdGhhdCBhcmUgbm90IGluIGFueSBtdXRleGVzIGFuZCBhcmUgbm90IHZhcmFyZy4KICAgIC0tIDMuIFBvc2l0aW9uYWwgYXJndW1lbnRzIC0gb24gdGhlaXIgb3duIG9yIGFzIGEgcGFydCBvZiBhIG11dGV4LgogICAgLS0gNC4gUmVtYWluaW5nIG11dGV4ZXMuCiAgICAtLSA1LiBSZW1haW5pbmcgb3B0aW9ucy4KCiAgICBsb2NhbCBlbGVtZW50c19pbl9tdXRleGVzID0ge30KICAgIGxvY2FsIGFkZGVkX2VsZW1lbnRzID0ge30KICAgIGxvY2FsIGFkZGVkX211dGV4ZXMgPSB7fQogICAgbG9jYWwgYXJndW1lbnRfdG9fbXV0ZXhlcyA9IHt9CgogICAgbG9jYWwgZnVuY3Rpb24gYWRkX211dGV4KG11dGV4LCBtYWluX2FyZ3VtZW50KQogICAgICAgIGlmIGFkZGVkX211dGV4ZXNbbXV0ZXhdIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGFkZGVkX211dGV4ZXNbbXV0ZXhdID0gdHJ1ZQogICAgICAgIGxvY2FsIGJ1ZiA9IHt9CgogICAgICAgIGZvciBfLCBlbGVtZW50IGluIGlwYWlycyhtdXRleCkgZG8KICAgICAgICAgICAgaWYgbm90IGVsZW1lbnQuX2hpZGRlbiBhbmQgbm90IGFkZGVkX2VsZW1lbnRzW2VsZW1lbnRdIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdldG1ldGF0YWJsZShlbGVtZW50KSA9PSBPcHRpb24gb3IgZWxlbWVudCA9PSBtYWluX2FyZ3VtZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCBlbGVtZW50Ol9nZXRfdXNhZ2UoKSkKICAgICAgICAgICAgICAgICAgICBhZGRlZF9lbGVtZW50c1tlbGVtZW50XSA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgI2J1ZiA9PSAxIHRoZW4KICAgICAgICAgICAgYWRkKGJ1ZlsxXSkKICAgICAgICBlbHNlaWYgI2J1ZiA+IDEgdGhlbgogICAgICAgICAgICBhZGQoIigiIC4uIHRhYmxlLmNvbmNhdChidWYsICIgfCAiKSAuLiAiKSIpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBhZGRfZWxlbWVudChlbGVtZW50KQogICAgICAgIGlmIG5vdCBlbGVtZW50Ll9oaWRkZW4gYW5kIG5vdCBhZGRlZF9lbGVtZW50c1tlbGVtZW50XSB0aGVuCiAgICAgICAgICAgIGFkZChlbGVtZW50Ol9nZXRfdXNhZ2UoKSkKICAgICAgICAgICAgYWRkZWRfZWxlbWVudHNbZWxlbWVudF0gPSB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgbXV0ZXggaW4gaXBhaXJzKHNlbGYuX211dGV4ZXMpIGRvCiAgICAgICAgbG9jYWwgaXNfdmFyYXJnID0gZmFsc2UKICAgICAgICBsb2NhbCBoYXNfYXJndW1lbnQgPSBmYWxzZQoKICAgICAgICBmb3IgXywgZWxlbWVudCBpbiBpcGFpcnMobXV0ZXgpIGRvCiAgICAgICAgICAgIGlmIGdldG1ldGF0YWJsZShlbGVtZW50KSA9PSBPcHRpb24gdGhlbgogICAgICAgICAgICAgICAgaWYgZWxlbWVudDpfaXNfdmFyYXJnKCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlzX3ZhcmFyZyA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBoYXNfYXJndW1lbnQgPSB0cnVlCiAgICAgICAgICAgICAgICBhcmd1bWVudF90b19tdXRleGVzW2VsZW1lbnRdID0gYXJndW1lbnRfdG9fbXV0ZXhlc1tlbGVtZW50XSBvciB7fQogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGFyZ3VtZW50X3RvX211dGV4ZXNbZWxlbWVudF0sIG11dGV4KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGVsZW1lbnRzX2luX211dGV4ZXNbZWxlbWVudF0gPSB0cnVlCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBpc192YXJhcmcgYW5kIG5vdCBoYXNfYXJndW1lbnQgdGhlbgogICAgICAgICAgICBhZGRfbXV0ZXgobXV0ZXgpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgb3B0aW9uIGluIGlwYWlycyhzZWxmLl9vcHRpb25zKSBkbwogICAgICAgIGlmIG5vdCBlbGVtZW50c19pbl9tdXRleGVzW29wdGlvbl0gYW5kIG5vdCBvcHRpb246X2lzX3ZhcmFyZygpIHRoZW4KICAgICAgICAgICAgYWRkX2VsZW1lbnQob3B0aW9uKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0gQWRkIHVzYWdlcyBmb3IgcG9zaXRpb25hbCBhcmd1bWVudHMsIHRvZ2V0aGVyIHdpdGggb25lIG11dGV4IGNvbnRhaW5pbmcgdGhlbSwgaWYgdGhleSBhcmUgaW4gYSBtdXRleC4KICAgIGZvciBfLCBhcmd1bWVudCBpbiBpcGFpcnMoc2VsZi5fYXJndW1lbnRzKSBkbwogICAgICAgIC0tIFBpY2sgYSBtdXRleCBhcyBhIHBhcnQgb2Ygd2hpY2ggdG8gc2hvdyB0aGlzIGFyZ3VtZW50LCB0YWtlIHRoZSBmaXJzdCBvbmUgdGhhdCdzIHN0aWxsIGF2YWlsYWJsZS4KICAgICAgICBsb2NhbCBtdXRleAoKICAgICAgICBpZiBlbGVtZW50c19pbl9tdXRleGVzW2FyZ3VtZW50XSB0aGVuCiAgICAgICAgICAgIGZvciBfLCBhcmd1bWVudF9tdXRleCBpbiBpcGFpcnMoYXJndW1lbnRfdG9fbXV0ZXhlc1thcmd1bWVudF0pIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgYWRkZWRfbXV0ZXhlc1thcmd1bWVudF9tdXRleF0gdGhlbgogICAgICAgICAgICAgICAgICAgIG11dGV4ID0gYXJndW1lbnRfbXV0ZXgKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgbXV0ZXggdGhlbgogICAgICAgICAgICBhZGRfbXV0ZXgobXV0ZXgsIGFyZ3VtZW50KQogICAgICAgIGVsc2UKICAgICAgICAgICAgYWRkX2VsZW1lbnQoYXJndW1lbnQpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgbXV0ZXggaW4gaXBhaXJzKHNlbGYuX211dGV4ZXMpIGRvCiAgICAgICAgYWRkX211dGV4KG11dGV4KQogICAgZW5kCgogICAgZm9yIF8sIG9wdGlvbiBpbiBpcGFpcnMoc2VsZi5fb3B0aW9ucykgZG8KICAgICAgICBhZGRfZWxlbWVudChvcHRpb24pCiAgICBlbmQKCiAgICBpZiAjc2VsZi5fY29tbWFuZHMgPiAwIHRoZW4KICAgICAgICBpZiBzZWxmLl9yZXF1aXJlX2NvbW1hbmQgdGhlbgogICAgICAgICAgICBhZGQoIjxjb21tYW5kPiIpCiAgICAgICAgZWxzZQogICAgICAgICAgICBhZGQoIls8Y29tbWFuZD5dIikKICAgICAgICBlbmQKCiAgICAgICAgYWRkKCIuLi4iKQogICAgZW5kCgogICAgcmV0dXJuIHRhYmxlLmNvbmNhdChsaW5lcywgIlxuIikKZW5kCgpsb2NhbCBmdW5jdGlvbiBzcGxpdF9saW5lcyhzKQogICAgaWYgcyA9PSAiIiB0aGVuCiAgICAgICAgcmV0dXJuIHt9CiAgICBlbmQKCiAgICBsb2NhbCBsaW5lcyA9IHt9CgogICAgaWYgczpzdWIoLTEpIH49ICJcbiIgdGhlbgogICAgICAgIHMgPSBzIC4uICJcbiIKICAgIGVuZAoKICAgIGZvciBsaW5lIGluIHM6Z21hdGNoKCIoW15cbl0qKVxuIikgZG8KICAgICAgICB0YWJsZS5pbnNlcnQobGluZXMsIGxpbmUpCiAgICBlbmQKCiAgICByZXR1cm4gbGluZXMKZW5kCgpsb2NhbCBmdW5jdGlvbiBhdXRvd3JhcF9saW5lKGxpbmUsIG1heF9sZW5ndGgpCiAgICAtLSBBbGdvcml0aG0gZm9yIHNwbGl0dGluZyBsaW5lcyBpcyBzaW1wbGUgYW5kIGdyZWVkeS4KICAgIGxvY2FsIHJlc3VsdF9saW5lcyA9IHt9CgogICAgLS0gUHJlc2VydmUgb3JpZ2luYWwgaW5kZW50YXRpb24gb2YgdGhlIGxpbmUsIHB1dCB0aGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgZWFjaCByZXN1bHQgbGluZS4KICAgIC0tIElmIHRoZSBmaXJzdCB3b3JkIGxvb2tzIGxpa2UgYSBsaXN0IG1hcmtlciAoJyonLCAnKycsIG9yICctJyksIGFkZCBzcGFjZXMgc28gdGhhdCBzdGFydHMKICAgIC0tIG9mIHRoZSBzZWNvbmQgYW5kIHRoZSBmb2xsb3dpbmcgbGluZXMgdmVydGljYWxseSBhbGlnbiB3aXRoIHRoZSBzdGFydCBvZiB0aGUgc2Vjb25kIHdvcmQuCiAgICBsb2NhbCBpbmRlbnRhdGlvbiA9IGxpbmU6bWF0Y2goIl4gKiIpCgogICAgaWYgbGluZTpmaW5kKCJeICpbJSolKyUtXSIpIHRoZW4KICAgICAgICBpbmRlbnRhdGlvbiA9IGluZGVudGF0aW9uIC4uICIgIiAuLiBsaW5lOm1hdGNoKCJeICpbJSolKyUtXSggKikiKQogICAgZW5kCgogICAgLS0gUGFydHMgb2YgdGhlIGxhc3QgbGluZSBiZWluZyBhc3NlbWJsZWQuCiAgICBsb2NhbCBsaW5lX3BhcnRzID0ge30KCiAgICAtLSBMZW5ndGggb2YgdGhlIGN1cnJlbnQgbGluZS4KICAgIGxvY2FsIGxpbmVfbGVuZ3RoID0gMAoKICAgIC0tIEluZGV4IG9mIHRoZSBuZXh0IGNoYXJhY3RlciB0byBjb25zaWRlci4KICAgIGxvY2FsIGluZGV4ID0gMQoKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBsb2NhbCB3b3JkX3N0YXJ0LCB3b3JkX2ZpbmlzaCwgd29yZCA9IGxpbmU6ZmluZCgiKFteIF0rKSIsIGluZGV4KQoKICAgICAgICBpZiBub3Qgd29yZF9zdGFydCB0aGVuCiAgICAgICAgICAgIC0tIElnbm9yZSB0cmFpbGluZyBzcGFjZXMsIGlmIGFueS4KICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgcHJlY2VkaW5nX3NwYWNlcyA9IGxpbmU6c3ViKGluZGV4LCB3b3JkX3N0YXJ0IC0gMSkKICAgICAgICBpbmRleCA9IHdvcmRfZmluaXNoICsgMQoKICAgICAgICBpZiAoI2xpbmVfcGFydHMgPT0gMCkgb3IgKGxpbmVfbGVuZ3RoICsgI3ByZWNlZGluZ19zcGFjZXMgKyAjd29yZCA8PSBtYXhfbGVuZ3RoKSB0aGVuCiAgICAgICAgICAgIC0tIEVpdGhlciB0aGlzIGlzIHRoZSB2ZXJ5IGZpcnN0IHdvcmQgb3IgaXQgZml0cyBhcyBhbiBhZGRpdGlvbiB0byB0aGUgY3VycmVudCBsaW5lLCBhZGQgaXQuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lX3BhcnRzLCBwcmVjZWRpbmdfc3BhY2VzKSAtLSBGb3IgdGhlIHZlcnkgZmlyc3Qgd29yZCB0aGlzIGFkZHMgdGhlIGluZGVudGF0aW9uLgogICAgICAgICAgICB0YWJsZS5pbnNlcnQobGluZV9wYXJ0cywgd29yZCkKICAgICAgICAgICAgbGluZV9sZW5ndGggPSBsaW5lX2xlbmd0aCArICNwcmVjZWRpbmdfc3BhY2VzICsgI3dvcmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIERvZXMgbm90IGZpdCwgZmluaXNoIGN1cnJlbnQgbGluZSBhbmQgcHV0IHRoZSB3b3JkIGludG8gYSBuZXcgb25lLgogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCB0YWJsZS5jb25jYXQobGluZV9wYXJ0cykpCiAgICAgICAgICAgIGxpbmVfcGFydHMgPSB7aW5kZW50YXRpb24sIHdvcmR9CiAgICAgICAgICAgIGxpbmVfbGVuZ3RoID0gI2luZGVudGF0aW9uICsgI3dvcmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmICNsaW5lX3BhcnRzID4gMCB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KHJlc3VsdF9saW5lcywgdGFibGUuY29uY2F0KGxpbmVfcGFydHMpKQogICAgZW5kCgogICAgaWYgI3Jlc3VsdF9saW5lcyA9PSAwIHRoZW4KICAgICAgICAtLSBQcmVzZXJ2ZSBlbXB0eSBsaW5lcy4KICAgICAgICByZXN1bHRfbGluZXNbMV0gPSAiIgogICAgZW5kCgogICAgcmV0dXJuIHJlc3VsdF9saW5lcwplbmQKCi0tIEF1dG9tYXRpY2FsbHkgd3JhcHMgbGluZXMgd2l0aGluIGdpdmVuIGFycmF5LAotLSBhdHRlbXB0aW5nIHRvIGxpbWl0IGxpbmUgbGVuZ3RoIHRvIGBtYXhfbGVuZ3RoYC4KLS0gRXhpc3RpbmcgbGluZSBzcGxpdHMgYXJlIHByZXNlcnZlZC4KbG9jYWwgZnVuY3Rpb24gYXV0b3dyYXAobGluZXMsIG1heF9sZW5ndGgpCiAgICBsb2NhbCByZXN1bHRfbGluZXMgPSB7fQoKICAgIGZvciBfLCBsaW5lIGluIGlwYWlycyhsaW5lcykgZG8KICAgICAgICBsb2NhbCBhdXRvd3JhcHBlZF9saW5lcyA9IGF1dG93cmFwX2xpbmUobGluZSwgbWF4X2xlbmd0aCkKCiAgICAgICAgZm9yIF8sIGF1dG93cmFwcGVkX2xpbmUgaW4gaXBhaXJzKGF1dG93cmFwcGVkX2xpbmVzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCBhdXRvd3JhcHBlZF9saW5lKQogICAgICAgIGVuZAogICAgZW5kCgogICAgcmV0dXJuIHJlc3VsdF9saW5lcwplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfZ2V0X2VsZW1lbnRfaGVscChlbGVtZW50KQogICAgbG9jYWwgbGFiZWxfbGluZXMgPSBlbGVtZW50Ol9nZXRfbGFiZWxfbGluZXMoKQogICAgbG9jYWwgZGVzY3JpcHRpb25fbGluZXMgPSBzcGxpdF9saW5lcyhlbGVtZW50Ol9nZXRfZGVzY3JpcHRpb24oKSkKCiAgICBsb2NhbCByZXN1bHRfbGluZXMgPSB7fQoKICAgIC0tIEFsbCBsYWJlbCBsaW5lcyBzaG91bGQgaGF2ZSB0aGUgc2FtZSBsZW5ndGggKGV4Y2VwdCB0aGUgbGFzdCBvbmUsIGl0IGhhcyBubyBjb21tYSkuCiAgICAtLSBJZiB0b28gbG9uZywgc3RhcnQgZGVzY3JpcHRpb24gYWZ0ZXIgYWxsIHRoZSBsYWJlbCBsaW5lcy4KICAgIC0tIE90aGVyd2lzZSwgY29tYmluZSBsYWJlbCBhbmQgZGVzY3JpcHRpb24gbGluZXMuCgogICAgbG9jYWwgdXNhZ2VfbWFyZ2luX2xlbiA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfdXNhZ2VfbWFyZ2luIiwgMykKICAgIGxvY2FsIHVzYWdlX21hcmdpbiA9ICgiICIpOnJlcCh1c2FnZV9tYXJnaW5fbGVuKQogICAgbG9jYWwgZGVzY3JpcHRpb25fbWFyZ2luX2xlbiA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfZGVzY3JpcHRpb25fbWFyZ2luIiwgMjUpCiAgICBsb2NhbCBkZXNjcmlwdGlvbl9tYXJnaW4gPSAoIiAiKTpyZXAoZGVzY3JpcHRpb25fbWFyZ2luX2xlbikKCiAgICBsb2NhbCBoZWxwX21heF93aWR0aCA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfbWF4X3dpZHRoIikKCiAgICBpZiBoZWxwX21heF93aWR0aCB0aGVuCiAgICAgICAgbG9jYWwgZGVzY3JpcHRpb25fbWF4X3dpZHRoID0gbWF0aC5tYXgoaGVscF9tYXhfd2lkdGggLSBkZXNjcmlwdGlvbl9tYXJnaW5fbGVuLCAxMCkKICAgICAgICBkZXNjcmlwdGlvbl9saW5lcyA9IGF1dG93cmFwKGRlc2NyaXB0aW9uX2xpbmVzLCBkZXNjcmlwdGlvbl9tYXhfd2lkdGgpCiAgICBlbmQKCiAgICBpZiAjbGFiZWxfbGluZXNbMV0gPj0gKGRlc2NyaXB0aW9uX21hcmdpbl9sZW4gLSB1c2FnZV9tYXJnaW5fbGVuKSB0aGVuCiAgICAgICAgZm9yIF8sIGxhYmVsX2xpbmUgaW4gaXBhaXJzKGxhYmVsX2xpbmVzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCB1c2FnZV9tYXJnaW4gLi4gbGFiZWxfbGluZSkKICAgICAgICBlbmQKCiAgICAgICAgZm9yIF8sIGRlc2NyaXB0aW9uX2xpbmUgaW4gaXBhaXJzKGRlc2NyaXB0aW9uX2xpbmVzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCBkZXNjcmlwdGlvbl9tYXJnaW4gLi4gZGVzY3JpcHRpb25fbGluZSkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBmb3IgaSA9IDEsIG1hdGgubWF4KCNsYWJlbF9saW5lcywgI2Rlc2NyaXB0aW9uX2xpbmVzKSBkbwogICAgICAgICAgICBsb2NhbCBsYWJlbF9saW5lID0gbGFiZWxfbGluZXNbaV0KICAgICAgICAgICAgbG9jYWwgZGVzY3JpcHRpb25fbGluZSA9IGRlc2NyaXB0aW9uX2xpbmVzW2ldCgogICAgICAgICAgICBsb2NhbCBsaW5lID0gIiIKCiAgICAgICAgICAgIGlmIGxhYmVsX2xpbmUgdGhlbgogICAgICAgICAgICAgICAgbGluZSA9IHVzYWdlX21hcmdpbiAuLiBsYWJlbF9saW5lCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgZGVzY3JpcHRpb25fbGluZSBhbmQgZGVzY3JpcHRpb25fbGluZSB+PSAiIiB0aGVuCiAgICAgICAgICAgICAgICBsaW5lID0gbGluZSAuLiAoIiAiKTpyZXAoZGVzY3JpcHRpb25fbWFyZ2luX2xlbiAtICNsaW5lKSAuLiBkZXNjcmlwdGlvbl9saW5lCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHJlc3VsdF9saW5lcywgbGluZSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiB0YWJsZS5jb25jYXQocmVzdWx0X2xpbmVzLCAiXG4iKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGdldF9ncm91cF90eXBlcyhncm91cCkKICAgIGxvY2FsIHR5cGVzID0ge30KCiAgICBmb3IgXywgZWxlbWVudCBpbiBpcGFpcnMoZ3JvdXApIGRvCiAgICAgICAgdHlwZXNbZ2V0bWV0YXRhYmxlKGVsZW1lbnQpXSA9IHRydWUKICAgIGVuZAoKICAgIHJldHVybiB0eXBlcwplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfYWRkX2dyb3VwX2hlbHAoYmxvY2tzLCBhZGRlZF9lbGVtZW50cywgbGFiZWwsIGVsZW1lbnRzKQogICAgbG9jYWwgYnVmID0ge2xhYmVsfQoKICAgIGZvciBfLCBlbGVtZW50IGluIGlwYWlycyhlbGVtZW50cykgZG8KICAgICAgICBpZiBub3QgZWxlbWVudC5faGlkZGVuIGFuZCBub3QgYWRkZWRfZWxlbWVudHNbZWxlbWVudF0gdGhlbgogICAgICAgICAgICBhZGRlZF9lbGVtZW50c1tlbGVtZW50XSA9IHRydWUKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGJ1Ziwgc2VsZjpfZ2V0X2VsZW1lbnRfaGVscChlbGVtZW50KSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmICNidWYgPiAxIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoYmxvY2tzLCB0YWJsZS5jb25jYXQoYnVmLCAoIlxuIik6cmVwKHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfdmVydGljYWxfc3BhY2UiLCAwKSArIDEpKSkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlcjpnZXRfaGVscCgpCiAgICBpZiBzZWxmLl9oZWxwIHRoZW4KICAgICAgICByZXR1cm4gc2VsZi5faGVscAogICAgZW5kCgogICAgbG9jYWwgYmxvY2tzID0ge3NlbGY6Z2V0X3VzYWdlKCl9CgogICAgbG9jYWwgaGVscF9tYXhfd2lkdGggPSBzZWxmOl9pbmhlcml0X3Byb3BlcnR5KCJoZWxwX21heF93aWR0aCIpCgogICAgaWYgc2VsZi5fZGVzY3JpcHRpb24gdGhlbgogICAgICAgIGxvY2FsIGRlc2NyaXB0aW9uID0gc2VsZi5fZGVzY3JpcHRpb24KCiAgICAgICAgaWYgaGVscF9tYXhfd2lkdGggdGhlbgogICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHRhYmxlLmNvbmNhdChhdXRvd3JhcChzcGxpdF9saW5lcyhkZXNjcmlwdGlvbiksIGhlbHBfbWF4X3dpZHRoKSwgIlxuIikKICAgICAgICBlbmQKCiAgICAgICAgdGFibGUuaW5zZXJ0KGJsb2NrcywgZGVzY3JpcHRpb24pCiAgICBlbmQKCiAgICAtLSAxLiBQdXQgZ3JvdXBzIGNvbnRhaW5pbmcgYXJndW1lbnRzIGZpcnN0LCB0aGVuIG90aGVyIGFyZ3VtZW50cy4KICAgIC0tIDIuIFB1dCByZW1haW5pbmcgZ3JvdXBzIGNvbnRhaW5pbmcgb3B0aW9ucywgdGhlbiBvdGhlciBvcHRpb25zLgogICAgLS0gMy4gUHV0IHJlbWFpbmluZyBncm91cHMgY29udGFpbmluZyBjb21tYW5kcywgdGhlbiBvdGhlciBjb21tYW5kcy4KICAgIC0tIEFzc3VtZSB0aGF0IGFuIGVsZW1lbnQgY2FuJ3QgYmUgaW4gc2V2ZXJhbCBncm91cHMuCiAgICBsb2NhbCBncm91cHNfYnlfdHlwZSA9IHsKICAgICAgICBbQXJndW1lbnRdID0ge30sCiAgICAgICAgW09wdGlvbl0gPSB7fSwKICAgICAgICBbQ29tbWFuZF0gPSB7fQogICAgfQoKICAgIGZvciBfLCBncm91cCBpbiBpcGFpcnMoc2VsZi5fZ3JvdXBzKSBkbwogICAgICAgIGxvY2FsIGdyb3VwX3R5cGVzID0gZ2V0X2dyb3VwX3R5cGVzKGdyb3VwKQoKICAgICAgICBmb3IgXywgbXQgaW4gaXBhaXJzKHtBcmd1bWVudCwgT3B0aW9uLCBDb21tYW5kfSkgZG8KICAgICAgICAgICAgaWYgZ3JvdXBfdHlwZXNbbXRdIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChncm91cHNfYnlfdHlwZVttdF0sIGdyb3VwKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBkZWZhdWx0X2dyb3VwcyA9IHsKICAgICAgICB7bmFtZSA9ICJBcmd1bWVudHMiLCB0eXBlID0gQXJndW1lbnQsIGVsZW1lbnRzID0gc2VsZi5fYXJndW1lbnRzfSwKICAgICAgICB7bmFtZSA9ICJPcHRpb25zIiwgdHlwZSA9IE9wdGlvbiwgZWxlbWVudHMgPSBzZWxmLl9vcHRpb25zfSwKICAgICAgICB7bmFtZSA9ICJDb21tYW5kcyIsIHR5cGUgPSBDb21tYW5kLCBlbGVtZW50cyA9IHNlbGYuX2NvbW1hbmRzfQogICAgfQoKICAgIGxvY2FsIGFkZGVkX2VsZW1lbnRzID0ge30KCiAgICBmb3IgXywgZGVmYXVsdF9ncm91cCBpbiBpcGFpcnMoZGVmYXVsdF9ncm91cHMpIGRvCiAgICAgICAgbG9jYWwgdHlwZV9ncm91cHMgPSBncm91cHNfYnlfdHlwZVtkZWZhdWx0X2dyb3VwLnR5cGVdCgogICAgICAgIGZvciBfLCBncm91cCBpbiBpcGFpcnModHlwZV9ncm91cHMpIGRvCiAgICAgICAgICAgIHNlbGY6X2FkZF9ncm91cF9oZWxwKGJsb2NrcywgYWRkZWRfZWxlbWVudHMsIGdyb3VwLm5hbWUgLi4gIjoiLCBncm91cCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZGVmYXVsdF9sYWJlbCA9IGRlZmF1bHRfZ3JvdXAubmFtZSAuLiAiOiIKCiAgICAgICAgaWYgI3R5cGVfZ3JvdXBzID4gMCB0aGVuCiAgICAgICAgICAgIGRlZmF1bHRfbGFiZWwgPSAiT3RoZXIgIiAuLiBkZWZhdWx0X2xhYmVsOmdzdWIoIl4uIiwgc3RyaW5nLmxvd2VyKQogICAgICAgIGVuZAoKICAgICAgICBzZWxmOl9hZGRfZ3JvdXBfaGVscChibG9ja3MsIGFkZGVkX2VsZW1lbnRzLCBkZWZhdWx0X2xhYmVsLCBkZWZhdWx0X2dyb3VwLmVsZW1lbnRzKQogICAgZW5kCgogICAgaWYgc2VsZi5fZXBpbG9nIHRoZW4KICAgICAgICBsb2NhbCBlcGlsb2cgPSBzZWxmLl9lcGlsb2cKCiAgICAgICAgaWYgaGVscF9tYXhfd2lkdGggdGhlbgogICAgICAgICAgICBlcGlsb2cgPSB0YWJsZS5jb25jYXQoYXV0b3dyYXAoc3BsaXRfbGluZXMoZXBpbG9nKSwgaGVscF9tYXhfd2lkdGgpLCAiXG4iKQogICAgICAgIGVuZAoKICAgICAgICB0YWJsZS5pbnNlcnQoYmxvY2tzLCBlcGlsb2cpCiAgICBlbmQKCiAgICByZXR1cm4gdGFibGUuY29uY2F0KGJsb2NrcywgIlxuXG4iKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGdldF90aXAoY29udGV4dCwgd3JvbmdfbmFtZSkKICAgIGxvY2FsIGNvbnRleHRfcG9vbCA9IHt9CiAgICBsb2NhbCBwb3NzaWJsZV9uYW1lCiAgICBsb2NhbCBwb3NzaWJsZV9uYW1lcyA9IHt9CgogICAgZm9yIG5hbWUgaW4gcGFpcnMoY29udGV4dCkgZG8KICAgICAgICBpZiB0eXBlKG5hbWUpID09ICJzdHJpbmciIHRoZW4KICAgICAgICAgICAgZm9yIGkgPSAxLCAjbmFtZSBkbwogICAgICAgICAgICAgICAgcG9zc2libGVfbmFtZSA9IG5hbWU6c3ViKDEsIGkgLSAxKSAuLiBuYW1lOnN1YihpICsgMSkKCiAgICAgICAgICAgICAgICBpZiBub3QgY29udGV4dF9wb29sW3Bvc3NpYmxlX25hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICBjb250ZXh0X3Bvb2xbcG9zc2libGVfbmFtZV0gPSB7fQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGNvbnRleHRfcG9vbFtwb3NzaWJsZV9uYW1lXSwgbmFtZSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgaSA9IDEsICN3cm9uZ19uYW1lICsgMSBkbwogICAgICAgIHBvc3NpYmxlX25hbWUgPSB3cm9uZ19uYW1lOnN1YigxLCBpIC0gMSkgLi4gd3JvbmdfbmFtZTpzdWIoaSArIDEpCgogICAgICAgIGlmIGNvbnRleHRbcG9zc2libGVfbmFtZV0gdGhlbgogICAgICAgICAgICBwb3NzaWJsZV9uYW1lc1twb3NzaWJsZV9uYW1lXSA9IHRydWUKICAgICAgICBlbHNlaWYgY29udGV4dF9wb29sW3Bvc3NpYmxlX25hbWVdIHRoZW4KICAgICAgICAgICAgZm9yIF8sIG5hbWUgaW4gaXBhaXJzKGNvbnRleHRfcG9vbFtwb3NzaWJsZV9uYW1lXSkgZG8KICAgICAgICAgICAgICAgIHBvc3NpYmxlX25hbWVzW25hbWVdID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGxvY2FsIGZpcnN0ID0gbmV4dChwb3NzaWJsZV9uYW1lcykKCiAgICBpZiBmaXJzdCB0aGVuCiAgICAgICAgaWYgbmV4dChwb3NzaWJsZV9uYW1lcywgZmlyc3QpIHRoZW4KICAgICAgICAgICAgbG9jYWwgcG9zc2libGVfbmFtZXNfYXJyID0ge30KCiAgICAgICAgICAgIGZvciBuYW1lIGluIHBhaXJzKHBvc3NpYmxlX25hbWVzKSBkbwogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBvc3NpYmxlX25hbWVzX2FyciwgIiciIC4uIG5hbWUgLi4gIiciKQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhYmxlLnNvcnQocG9zc2libGVfbmFtZXNfYXJyKQogICAgICAgICAgICByZXR1cm4gIlxuRGlkIHlvdSBtZWFuIG9uZSBvZiB0aGVzZTogIiAuLiB0YWJsZS5jb25jYXQocG9zc2libGVfbmFtZXNfYXJyLCAiICIpIC4uICI/IgogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuICJcbkRpZCB5b3UgbWVhbiAnIiAuLiBmaXJzdCAuLiAiJz8iCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgcmV0dXJuICIiCiAgICBlbmQKZW5kCgpsb2NhbCBFbGVtZW50U3RhdGUgPSBjbGFzcyh7CiAgICBpbnZvY2F0aW9ucyA9IDAKfSkKCmZ1bmN0aW9uIEVsZW1lbnRTdGF0ZTpfX2NhbGwoc3RhdGUsIGVsZW1lbnQpCiAgICBzZWxmLnN0YXRlID0gc3RhdGUKICAgIHNlbGYucmVzdWx0ID0gc3RhdGUucmVzdWx0CiAgICBzZWxmLmVsZW1lbnQgPSBlbGVtZW50CiAgICBzZWxmLnRhcmdldCA9IGVsZW1lbnQuX3RhcmdldCBvciBlbGVtZW50Ol9nZXRfZGVmYXVsdF90YXJnZXQoKQogICAgc2VsZi5hY3Rpb24sIHNlbGYucmVzdWx0W3NlbGYudGFyZ2V0XSA9IGVsZW1lbnQ6X2dldF9hY3Rpb24oKQogICAgcmV0dXJuIHNlbGYKZW5kCgpmdW5jdGlvbiBFbGVtZW50U3RhdGU6ZXJyb3IoZm10LCAuLi4pCiAgICBzZWxmLnN0YXRlOmVycm9yKGZtdCwgLi4uKQplbmQKCmZ1bmN0aW9uIEVsZW1lbnRTdGF0ZTpjb252ZXJ0KGFyZ3VtZW50LCBpbmRleCkKICAgIGxvY2FsIGNvbnZlcnRlciA9IHNlbGYuZWxlbWVudC5fY29udmVydAoKICAgIGlmIGNvbnZlcnRlciB0aGVuCiAgICAgICAgbG9jYWwgb2ssIGVycgoKICAgICAgICBpZiB0eXBlKGNvbnZlcnRlcikgPT0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgICAgIG9rLCBlcnIgPSBjb252ZXJ0ZXIoYXJndW1lbnQpCiAgICAgICAgZWxzZWlmIHR5cGUoY29udmVydGVyW2luZGV4XSkgPT0gImZ1bmN0aW9uIiB0aGVuCiAgICAgICAgICAgIG9rLCBlcnIgPSBjb252ZXJ0ZXJbaW5kZXhdKGFyZ3VtZW50KQogICAgICAgIGVsc2UKICAgICAgICAgICAgb2sgPSBjb252ZXJ0ZXJbYXJndW1lbnRdCiAgICAgICAgZW5kCgogICAgICAgIGlmIG9rID09IG5pbCB0aGVuCiAgICAgICAgICAgIHNlbGY6ZXJyb3IoZXJyIGFuZCAiJXMiIG9yICJtYWxmb3JtZWQgYXJndW1lbnQgJyVzJyIsIGVyciBvciBhcmd1bWVudCkKICAgICAgICBlbmQKCiAgICAgICAgYXJndW1lbnQgPSBvawogICAgZW5kCgogICAgcmV0dXJuIGFyZ3VtZW50CmVuZAoKZnVuY3Rpb24gRWxlbWVudFN0YXRlOmRlZmF1bHQobW9kZSkKICAgIHJldHVybiBzZWxmLmVsZW1lbnQuX2RlZm1vZGU6ZmluZChtb2RlKSBhbmQgc2VsZi5lbGVtZW50Ll9kZWZhdWx0CmVuZAoKbG9jYWwgZnVuY3Rpb24gYm91bmQobm91biwgbWluLCBtYXgsIGlzX21heCkKICAgIGxvY2FsIHJlcyA9ICIiCgogICAgaWYgbWluIH49IG1heCB0aGVuCiAgICAgICAgcmVzID0gImF0ICIgLi4gKGlzX21heCBhbmQgIm1vc3QiIG9yICJsZWFzdCIpIC4uICIgIgogICAgZW5kCgogICAgbG9jYWwgbnVtYmVyID0gaXNfbWF4IGFuZCBtYXggb3IgbWluCiAgICByZXR1cm4gcmVzIC4uIHRvc3RyaW5nKG51bWJlcikgLi4gIiAiIC4uIG5vdW4gLi4gIChudW1iZXIgPT0gMSBhbmQgIiIgb3IgInMiKQplbmQKCmZ1bmN0aW9uIEVsZW1lbnRTdGF0ZTpzZXRfbmFtZShhbGlhcykKICAgIHNlbGYubmFtZSA9ICgiJXMgJyVzJyIpOmZvcm1hdChhbGlhcyBhbmQgIm9wdGlvbiIgb3IgImFyZ3VtZW50IiwgYWxpYXMgb3Igc2VsZi5lbGVtZW50Ll9uYW1lKQplbmQKCmZ1bmN0aW9uIEVsZW1lbnRTdGF0ZTppbnZva2UoKQogICAgc2VsZi5vcGVuID0gdHJ1ZQogICAgc2VsZi5vdmVyd3JpdGUgPSBmYWxzZQoKICAgIGlmIHNlbGYuaW52b2NhdGlvbnMgPj0gc2VsZi5lbGVtZW50Ll9tYXhjb3VudCB0aGVuCiAgICAgICAgaWYgc2VsZi5lbGVtZW50Ll9vdmVyd3JpdGUgdGhlbgogICAgICAgICAgICBzZWxmLm92ZXJ3cml0ZSA9IHRydWUKICAgICAgICBlbHNlCiAgICAgICAgICAgIGxvY2FsIG51bV90aW1lc19yZXByID0gYm91bmQoInRpbWUiLCBzZWxmLmVsZW1lbnQuX21pbmNvdW50LCBzZWxmLmVsZW1lbnQuX21heGNvdW50LCB0cnVlKQogICAgICAgICAgICBzZWxmOmVycm9yKCIlcyBtdXN0IGJlIHVzZWQgJXMiLCBzZWxmLm5hbWUsIG51bV90aW1lc19yZXByKQogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIHNlbGYuaW52b2NhdGlvbnMgPSBzZWxmLmludm9jYXRpb25zICsgMQogICAgZW5kCgogICAgc2VsZi5hcmdzID0ge30KCiAgICBpZiBzZWxmLmVsZW1lbnQuX21heGFyZ3MgPD0gMCB0aGVuCiAgICAgICAgc2VsZjpjbG9zZSgpCiAgICBlbmQKCiAgICByZXR1cm4gc2VsZi5vcGVuCmVuZAoKZnVuY3Rpb24gRWxlbWVudFN0YXRlOnBhc3MoYXJndW1lbnQpCiAgICBhcmd1bWVudCA9IHNlbGY6Y29udmVydChhcmd1bWVudCwgI3NlbGYuYXJncyArIDEpCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5hcmdzLCBhcmd1bWVudCkKCiAgICBpZiAjc2VsZi5hcmdzID49IHNlbGYuZWxlbWVudC5fbWF4YXJncyB0aGVuCiAgICAgICAgc2VsZjpjbG9zZSgpCiAgICBlbmQKCiAgICByZXR1cm4gc2VsZi5vcGVuCmVuZAoKZnVuY3Rpb24gRWxlbWVudFN0YXRlOmNvbXBsZXRlX2ludm9jYXRpb24oKQogICAgd2hpbGUgI3NlbGYuYXJncyA8IHNlbGYuZWxlbWVudC5fbWluYXJncyBkbwogICAgICAgIHNlbGY6cGFzcyhzZWxmLmVsZW1lbnQuX2RlZmF1bHQpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBFbGVtZW50U3RhdGU6Y2xvc2UoKQogICAgaWYgc2VsZi5vcGVuIHRoZW4KICAgICAgICBzZWxmLm9wZW4gPSBmYWxzZQoKICAgICAgICBpZiAjc2VsZi5hcmdzIDwgc2VsZi5lbGVtZW50Ll9taW5hcmdzIHRoZW4KICAgICAgICAgICAgaWYgc2VsZjpkZWZhdWx0KCJhIikgdGhlbgogICAgICAgICAgICAgICAgc2VsZjpjb21wbGV0ZV9pbnZvY2F0aW9uKCkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgaWYgI3NlbGYuYXJncyA9PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBnZXRtZXRhdGFibGUoc2VsZi5lbGVtZW50KSA9PSBBcmd1bWVudCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6ZXJyb3IoIm1pc3NpbmcgJXMiLCBzZWxmLm5hbWUpCiAgICAgICAgICAgICAgICAgICAgZWxzZWlmIHNlbGYuZWxlbWVudC5fbWF4YXJncyA9PSAxIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjplcnJvcigiJXMgcmVxdWlyZXMgYW4gYXJndW1lbnQiLCBzZWxmLm5hbWUpCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICBzZWxmOmVycm9yKCIlcyByZXF1aXJlcyAlcyIsIHNlbGYubmFtZSwgYm91bmQoImFyZ3VtZW50Iiwgc2VsZi5lbGVtZW50Ll9taW5hcmdzLCBzZWxmLmVsZW1lbnQuX21heGFyZ3MpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgYXJncwoKICAgICAgICBpZiBzZWxmLmVsZW1lbnQuX21heGFyZ3MgPT0gMCB0aGVuCiAgICAgICAgICAgIGFyZ3MgPSBzZWxmLmFyZ3NbMV0KICAgICAgICBlbHNlaWYgc2VsZi5lbGVtZW50Ll9tYXhhcmdzID09IDEgdGhlbgogICAgICAgICAgICBpZiBzZWxmLmVsZW1lbnQuX21pbmFyZ3MgPT0gMCBhbmQgc2VsZi5lbGVtZW50Ll9taW5jb3VudCB+PSBzZWxmLmVsZW1lbnQuX21heGNvdW50IHRoZW4KICAgICAgICAgICAgICAgIGFyZ3MgPSBzZWxmLmFyZ3MKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgYXJncyA9IHNlbGYuYXJnc1sxXQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFyZ3MgPSBzZWxmLmFyZ3MKICAgICAgICBlbmQKCiAgICAgICAgc2VsZi5hY3Rpb24oc2VsZi5yZXN1bHQsIHNlbGYudGFyZ2V0LCBhcmdzLCBzZWxmLm92ZXJ3cml0ZSkKICAgIGVuZAplbmQKCmxvY2FsIFBhcnNlU3RhdGUgPSBjbGFzcyh7CiAgICByZXN1bHQgPSB7fSwKICAgIG9wdGlvbnMgPSB7fSwKICAgIGFyZ3VtZW50cyA9IHt9LAogICAgYXJndW1lbnRfaSA9IDEsCiAgICBlbGVtZW50X3RvX211dGV4ZXMgPSB7fSwKICAgIG11dGV4X3RvX2VsZW1lbnRfc3RhdGUgPSB7fSwKICAgIGNvbW1hbmRfYWN0aW9ucyA9IHt9Cn0pCgpmdW5jdGlvbiBQYXJzZVN0YXRlOl9fY2FsbChwYXJzZXIsIGVycm9yX2hhbmRsZXIpCiAgICBzZWxmLnBhcnNlciA9IHBhcnNlcgogICAgc2VsZi5lcnJvcl9oYW5kbGVyID0gZXJyb3JfaGFuZGxlcgogICAgc2VsZi5jaGFyc2V0ID0gcGFyc2VyOl91cGRhdGVfY2hhcnNldCgpCiAgICBzZWxmOnN3aXRjaChwYXJzZXIpCiAgICByZXR1cm4gc2VsZgplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6ZXJyb3IoZm10LCAuLi4pCiAgICBzZWxmLmVycm9yX2hhbmRsZXIoc2VsZi5wYXJzZXIsIGZtdDpmb3JtYXQoLi4uKSkKZW5kCgpmdW5jdGlvbiBQYXJzZVN0YXRlOnN3aXRjaChwYXJzZXIpCiAgICBzZWxmLnBhcnNlciA9IHBhcnNlcgoKICAgIGlmIHBhcnNlci5fYWN0aW9uIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5jb21tYW5kX2FjdGlvbnMsIHthY3Rpb24gPSBwYXJzZXIuX2FjdGlvbiwgbmFtZSA9IHBhcnNlci5fbmFtZX0pCiAgICBlbmQKCiAgICBmb3IgXywgb3B0aW9uIGluIGlwYWlycyhwYXJzZXIuX29wdGlvbnMpIGRvCiAgICAgICAgb3B0aW9uID0gRWxlbWVudFN0YXRlKHNlbGYsIG9wdGlvbikKICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5vcHRpb25zLCBvcHRpb24pCgogICAgICAgIGZvciBfLCBhbGlhcyBpbiBpcGFpcnMob3B0aW9uLmVsZW1lbnQuX2FsaWFzZXMpIGRvCiAgICAgICAgICAgIHNlbGYub3B0aW9uc1thbGlhc10gPSBvcHRpb24KICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZvciBfLCBtdXRleCBpbiBpcGFpcnMocGFyc2VyLl9tdXRleGVzKSBkbwogICAgICAgIGZvciBfLCBlbGVtZW50IGluIGlwYWlycyhtdXRleCkgZG8KICAgICAgICAgICAgaWYgbm90IHNlbGYuZWxlbWVudF90b19tdXRleGVzW2VsZW1lbnRdIHRoZW4KICAgICAgICAgICAgICAgIHNlbGYuZWxlbWVudF90b19tdXRleGVzW2VsZW1lbnRdID0ge30KICAgICAgICAgICAgZW5kCgogICAgICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5lbGVtZW50X3RvX211dGV4ZXNbZWxlbWVudF0sIG11dGV4KQogICAgICAgIGVuZAogICAgZW5kCgogICAgZm9yIF8sIGFyZ3VtZW50IGluIGlwYWlycyhwYXJzZXIuX2FyZ3VtZW50cykgZG8KICAgICAgICBhcmd1bWVudCA9IEVsZW1lbnRTdGF0ZShzZWxmLCBhcmd1bWVudCkKICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5hcmd1bWVudHMsIGFyZ3VtZW50KQogICAgICAgIGFyZ3VtZW50OnNldF9uYW1lKCkKICAgICAgICBhcmd1bWVudDppbnZva2UoKQogICAgZW5kCgogICAgc2VsZi5oYW5kbGVfb3B0aW9ucyA9IHBhcnNlci5faGFuZGxlX29wdGlvbnMKICAgIHNlbGYuYXJndW1lbnQgPSBzZWxmLmFyZ3VtZW50c1tzZWxmLmFyZ3VtZW50X2ldCiAgICBzZWxmLmNvbW1hbmRzID0gcGFyc2VyLl9jb21tYW5kcwoKICAgIGZvciBfLCBjb21tYW5kIGluIGlwYWlycyhzZWxmLmNvbW1hbmRzKSBkbwogICAgICAgIGZvciBfLCBhbGlhcyBpbiBpcGFpcnMoY29tbWFuZC5fYWxpYXNlcykgZG8KICAgICAgICAgICAgc2VsZi5jb21tYW5kc1thbGlhc10gPSBjb21tYW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBQYXJzZVN0YXRlOmdldF9vcHRpb24obmFtZSkKICAgIGxvY2FsIG9wdGlvbiA9IHNlbGYub3B0aW9uc1tuYW1lXQoKICAgIGlmIG5vdCBvcHRpb24gdGhlbgogICAgICAgIHNlbGY6ZXJyb3IoInVua25vd24gb3B0aW9uICclcyclcyIsIG5hbWUsIGdldF90aXAoc2VsZi5vcHRpb25zLCBuYW1lKSkKICAgIGVsc2UKICAgICAgICByZXR1cm4gb3B0aW9uCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBQYXJzZVN0YXRlOmdldF9jb21tYW5kKG5hbWUpCiAgICBsb2NhbCBjb21tYW5kID0gc2VsZi5jb21tYW5kc1tuYW1lXQoKICAgIGlmIG5vdCBjb21tYW5kIHRoZW4KICAgICAgICBpZiAjc2VsZi5jb21tYW5kcyA+IDAgdGhlbgogICAgICAgICAgICBzZWxmOmVycm9yKCJ1bmtub3duIGNvbW1hbmQgJyVzJyVzIiwgbmFtZSwgZ2V0X3RpcChzZWxmLmNvbW1hbmRzLCBuYW1lKSkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNlbGY6ZXJyb3IoInRvbyBtYW55IGFyZ3VtZW50cyIpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIGNvbW1hbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6Y2hlY2tfbXV0ZXhlcyhlbGVtZW50X3N0YXRlKQogICAgaWYgc2VsZi5lbGVtZW50X3RvX211dGV4ZXNbZWxlbWVudF9zdGF0ZS5lbGVtZW50XSB0aGVuCiAgICAgICAgZm9yIF8sIG11dGV4IGluIGlwYWlycyhzZWxmLmVsZW1lbnRfdG9fbXV0ZXhlc1tlbGVtZW50X3N0YXRlLmVsZW1lbnRdKSBkbwogICAgICAgICAgICBsb2NhbCB1c2VkX2VsZW1lbnRfc3RhdGUgPSBzZWxmLm11dGV4X3RvX2VsZW1lbnRfc3RhdGVbbXV0ZXhdCgogICAgICAgICAgICBpZiB1c2VkX2VsZW1lbnRfc3RhdGUgYW5kIHVzZWRfZWxlbWVudF9zdGF0ZSB+PSBlbGVtZW50X3N0YXRlIHRoZW4KICAgICAgICAgICAgICAgIHNlbGY6ZXJyb3IoIiVzIGNhbiBub3QgYmUgdXNlZCB0b2dldGhlciB3aXRoICVzIiwgZWxlbWVudF9zdGF0ZS5uYW1lLCB1c2VkX2VsZW1lbnRfc3RhdGUubmFtZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2VsZi5tdXRleF90b19lbGVtZW50X3N0YXRlW211dGV4XSA9IGVsZW1lbnRfc3RhdGUKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBQYXJzZVN0YXRlOmludm9rZShvcHRpb24sIG5hbWUpCiAgICBzZWxmOmNsb3NlKCkKICAgIG9wdGlvbjpzZXRfbmFtZShuYW1lKQogICAgc2VsZjpjaGVja19tdXRleGVzKG9wdGlvbiwgbmFtZSkKCiAgICBpZiBvcHRpb246aW52b2tlKCkgdGhlbgogICAgICAgIHNlbGYub3B0aW9uID0gb3B0aW9uCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBQYXJzZVN0YXRlOnBhc3MoYXJnKQogICAgaWYgc2VsZi5vcHRpb24gdGhlbgogICAgICAgIGlmIG5vdCBzZWxmLm9wdGlvbjpwYXNzKGFyZykgdGhlbgogICAgICAgICAgICBzZWxmLm9wdGlvbiA9IG5pbAogICAgICAgIGVuZAogICAgZWxzZWlmIHNlbGYuYXJndW1lbnQgdGhlbgogICAgICAgIHNlbGY6Y2hlY2tfbXV0ZXhlcyhzZWxmLmFyZ3VtZW50KQoKICAgICAgICBpZiBub3Qgc2VsZi5hcmd1bWVudDpwYXNzKGFyZykgdGhlbgogICAgICAgICAgICBzZWxmLmFyZ3VtZW50X2kgPSBzZWxmLmFyZ3VtZW50X2kgKyAxCiAgICAgICAgICAgIHNlbGYuYXJndW1lbnQgPSBzZWxmLmFyZ3VtZW50c1tzZWxmLmFyZ3VtZW50X2ldCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgbG9jYWwgY29tbWFuZCA9IHNlbGY6Z2V0X2NvbW1hbmQoYXJnKQogICAgICAgIHNlbGYucmVzdWx0W2NvbW1hbmQuX3RhcmdldCBvciBjb21tYW5kLl9uYW1lXSA9IHRydWUKCiAgICAgICAgaWYgc2VsZi5wYXJzZXIuX2NvbW1hbmRfdGFyZ2V0IHRoZW4KICAgICAgICAgICAgc2VsZi5yZXN1bHRbc2VsZi5wYXJzZXIuX2NvbW1hbmRfdGFyZ2V0XSA9IGNvbW1hbmQuX25hbWUKICAgICAgICBlbmQKCiAgICAgICAgc2VsZjpzd2l0Y2goY29tbWFuZCkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6Y2xvc2UoKQogICAgaWYgc2VsZi5vcHRpb24gdGhlbgogICAgICAgIHNlbGYub3B0aW9uOmNsb3NlKCkKICAgICAgICBzZWxmLm9wdGlvbiA9IG5pbAogICAgZW5kCmVuZAoKZnVuY3Rpb24gUGFyc2VTdGF0ZTpmaW5hbGl6ZSgpCiAgICBzZWxmOmNsb3NlKCkKCiAgICBmb3IgaSA9IHNlbGYuYXJndW1lbnRfaSwgI3NlbGYuYXJndW1lbnRzIGRvCiAgICAgICAgbG9jYWwgYXJndW1lbnQgPSBzZWxmLmFyZ3VtZW50c1tpXQogICAgICAgIGlmICNhcmd1bWVudC5hcmdzID09IDAgYW5kIGFyZ3VtZW50OmRlZmF1bHQoInUiKSB0aGVuCiAgICAgICAgICAgIGFyZ3VtZW50OmNvbXBsZXRlX2ludm9jYXRpb24oKQogICAgICAgIGVsc2UKICAgICAgICAgICAgYXJndW1lbnQ6Y2xvc2UoKQogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgc2VsZi5wYXJzZXIuX3JlcXVpcmVfY29tbWFuZCBhbmQgI3NlbGYuY29tbWFuZHMgPiAwIHRoZW4KICAgICAgICBzZWxmOmVycm9yKCJhIGNvbW1hbmQgaXMgcmVxdWlyZWQiKQogICAgZW5kCgogICAgZm9yIF8sIG9wdGlvbiBpbiBpcGFpcnMoc2VsZi5vcHRpb25zKSBkbwogICAgICAgIG9wdGlvbi5uYW1lID0gb3B0aW9uLm5hbWUgb3IgKCJvcHRpb24gJyVzJyIpOmZvcm1hdChvcHRpb24uZWxlbWVudC5fbmFtZSkKCiAgICAgICAgaWYgb3B0aW9uLmludm9jYXRpb25zID09IDAgdGhlbgogICAgICAgICAgICBpZiBvcHRpb246ZGVmYXVsdCgidSIpIHRoZW4KICAgICAgICAgICAgICAgIG9wdGlvbjppbnZva2UoKQogICAgICAgICAgICAgICAgb3B0aW9uOmNvbXBsZXRlX2ludm9jYXRpb24oKQogICAgICAgICAgICAgICAgb3B0aW9uOmNsb3NlKCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGxvY2FsIG1pbmNvdW50ID0gb3B0aW9uLmVsZW1lbnQuX21pbmNvdW50CgogICAgICAgIGlmIG9wdGlvbi5pbnZvY2F0aW9ucyA8IG1pbmNvdW50IHRoZW4KICAgICAgICAgICAgaWYgb3B0aW9uOmRlZmF1bHQoImEiKSB0aGVuCiAgICAgICAgICAgICAgICB3aGlsZSBvcHRpb24uaW52b2NhdGlvbnMgPCBtaW5jb3VudCBkbwogICAgICAgICAgICAgICAgICAgIG9wdGlvbjppbnZva2UoKQogICAgICAgICAgICAgICAgICAgIG9wdGlvbjpjbG9zZSgpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZWxzZWlmIG9wdGlvbi5pbnZvY2F0aW9ucyA9PSAwIHRoZW4KICAgICAgICAgICAgICAgIHNlbGY6ZXJyb3IoIm1pc3NpbmcgJXMiLCBvcHRpb24ubmFtZSkKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2VsZjplcnJvcigiJXMgbXVzdCBiZSB1c2VkICVzIiwgb3B0aW9uLm5hbWUsIGJvdW5kKCJ0aW1lIiwgbWluY291bnQsIG9wdGlvbi5lbGVtZW50Ll9tYXhjb3VudCkpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgZm9yIGkgPSAjc2VsZi5jb21tYW5kX2FjdGlvbnMsIDEsIC0xIGRvCiAgICAgICAgc2VsZi5jb21tYW5kX2FjdGlvbnNbaV0uYWN0aW9uKHNlbGYucmVzdWx0LCBzZWxmLmNvbW1hbmRfYWN0aW9uc1tpXS5uYW1lKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gUGFyc2VTdGF0ZTpwYXJzZShhcmdzKQogICAgZm9yIF8sIGFyZyBpbiBpcGFpcnMoYXJncykgZG8KICAgICAgICBsb2NhbCBwbGFpbiA9IHRydWUKCiAgICAgICAgaWYgc2VsZi5oYW5kbGVfb3B0aW9ucyB0aGVuCiAgICAgICAgICAgIGxvY2FsIGZpcnN0ID0gYXJnOnN1YigxLCAxKQoKICAgICAgICAgICAgaWYgc2VsZi5jaGFyc2V0W2ZpcnN0XSB0aGVuCiAgICAgICAgICAgICAgICBpZiAjYXJnID4gMSB0aGVuCiAgICAgICAgICAgICAgICAgICAgcGxhaW4gPSBmYWxzZQoKICAgICAgICAgICAgICAgICAgICBpZiBhcmc6c3ViKDIsIDIpID09IGZpcnN0IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgI2FyZyA9PSAyIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYub3B0aW9uc1thcmddIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBvcHRpb24gPSBzZWxmOmdldF9vcHRpb24oYXJnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6aW52b2tlKG9wdGlvbiwgYXJnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6Y2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVfb3B0aW9ucyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGVxdWFscyA9IGFyZzpmaW5kICI9IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXF1YWxzIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gYXJnOnN1YigxLCBlcXVhbHMgLSAxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG9wdGlvbiA9IHNlbGY6Z2V0X29wdGlvbihuYW1lKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcHRpb24uZWxlbWVudC5fbWF4YXJncyA8PSAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjplcnJvcigib3B0aW9uICclcycgZG9lcyBub3QgdGFrZSBhcmd1bWVudHMiLCBuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmOmludm9rZShvcHRpb24sIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjpwYXNzKGFyZzpzdWIoZXF1YWxzICsgMSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgb3B0aW9uID0gc2VsZjpnZXRfb3B0aW9uKGFyZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmOmludm9rZShvcHRpb24sIGFyZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpID0gMiwgI2FyZyBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgbmFtZSA9IGZpcnN0IC4uIGFyZzpzdWIoaSwgaSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG9wdGlvbiA9IHNlbGY6Z2V0X29wdGlvbihuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjppbnZva2Uob3B0aW9uLCBuYW1lKQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkgfj0gI2FyZyBhbmQgb3B0aW9uLmVsZW1lbnQuX21heGFyZ3MgPiAwIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmOnBhc3MoYXJnOnN1YihpICsgMSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgcGxhaW4gdGhlbgogICAgICAgICAgICBzZWxmOnBhc3MoYXJnKQogICAgICAgIGVuZAogICAgZW5kCgogICAgc2VsZjpmaW5hbGl6ZSgpCiAgICByZXR1cm4gc2VsZi5yZXN1bHQKZW5kCgpmdW5jdGlvbiBQYXJzZXI6ZXJyb3IobXNnKQogICAgaW8uc3RkZXJyOndyaXRlKCgiJXNcblxuRXJyb3I6ICVzXG4iKTpmb3JtYXQoc2VsZjpnZXRfdXNhZ2UoKSwgbXNnKSkKICAgIG9zLmV4aXQoMSkKZW5kCgotLSBDb21wYXRpYmlsaXR5IHdpdGggc3RyaWN0Lmx1YSBhbmQgb3RoZXIgY2hlY2tlcnM6CmxvY2FsIGRlZmF1bHRfY21kbGluZSA9IHJhd2dldChfRywgImFyZyIpIG9yIHt9CgpmdW5jdGlvbiBQYXJzZXI6X3BhcnNlKGFyZ3MsIGVycm9yX2hhbmRsZXIpCiAgICByZXR1cm4gUGFyc2VTdGF0ZShzZWxmLCBlcnJvcl9oYW5kbGVyKTpwYXJzZShhcmdzIG9yIGRlZmF1bHRfY21kbGluZSkKZW5kCgpmdW5jdGlvbiBQYXJzZXI6cGFyc2UoYXJncykKICAgIHJldHVybiBzZWxmOl9wYXJzZShhcmdzLCBzZWxmLmVycm9yKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHhwY2FsbF9lcnJvcl9oYW5kbGVyKGVycikKICAgIHJldHVybiB0b3N0cmluZyhlcnIpIC4uICJcbm9yaWdpbmFsICIgLi4gZGVidWcudHJhY2ViYWNrKCIiLCAyKTpzdWIoMikKZW5kCgpmdW5jdGlvbiBQYXJzZXI6cHBhcnNlKGFyZ3MpCiAgICBsb2NhbCBwYXJzZV9lcnJvcgoKICAgIGxvY2FsIG9rLCByZXN1bHQgPSB4cGNhbGwoZnVuY3Rpb24oKQogICAgICAgIHJldHVybiBzZWxmOl9wYXJzZShhcmdzLCBmdW5jdGlvbihfLCBlcnIpCiAgICAgICAgICAgIHBhcnNlX2Vycm9yID0gZXJyCiAgICAgICAgICAgIGVycm9yKGVyciwgMCkKICAgICAgICBlbmQpCiAgICBlbmQsIHhwY2FsbF9lcnJvcl9oYW5kbGVyKQoKICAgIGlmIG9rIHRoZW4KICAgICAgICByZXR1cm4gdHJ1ZSwgcmVzdWx0CiAgICBlbHNlaWYgbm90IHBhcnNlX2Vycm9yIHRoZW4KICAgICAgICBlcnJvcihyZXN1bHQsIDApCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIGZhbHNlLCBwYXJzZV9lcnJvcgogICAgZW5kCmVuZAoKbG9jYWwgYXJncGFyc2UgPSB7fQoKYXJncGFyc2UudmVyc2lvbiA9ICIwLjYuMCIKCnNldG1ldGF0YWJsZShhcmdwYXJzZSwge19fY2FsbCA9IGZ1bmN0aW9uKF8sIC4uLikKICAgIHJldHVybiBQYXJzZXIoZGVmYXVsdF9jbWRsaW5lWzBdKTphZGRfaGVscCh0cnVlKSguLi4pCmVuZH0pCgpyZXR1cm4gYXJncGFyc2UK"
